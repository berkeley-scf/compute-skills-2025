<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Numerics, reproducibility, and automation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-a9ac95982dfa497af26296eb1ce0c91d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles.css">
<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../units/comp-practices.html">Modules</a></li><li class="breadcrumb-item"><a href="../units/additional-topics.html">Numerics and Reproducibility</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../assets/stat_bear.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Computational Skills Workshop</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/berkeley-scf/compute-skills-2025" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home / Schedule</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../syllabus.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../prep.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computational Environment</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Modules</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/comp-practices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Computational Tools and Practices</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/additional-topics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Numerics and Reproducibility</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/intro-computing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Computing and Command Line (optional)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/intro-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Intro to Python (optional)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../units/mini-project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Mini Project (optional)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../license.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">License</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#multi-user-git" id="toc-multi-user-git" class="nav-link active" data-scroll-target="#multi-user-git">7. Multi-user Git</a>
  <ul class="collapse">
  <li><a href="#demo-branching-and-pull-requests-merge-conflicts" id="toc-demo-branching-and-pull-requests-merge-conflicts" class="nav-link" data-scroll-target="#demo-branching-and-pull-requests-merge-conflicts">Demo: Branching and pull requests, merge conflicts</a>
  <ul class="collapse">
  <li><a href="#branching" id="toc-branching" class="nav-link" data-scroll-target="#branching">Branching</a></li>
  <li><a href="#pull-requests" id="toc-pull-requests" class="nav-link" data-scroll-target="#pull-requests">Pull requests</a></li>
  <li><a href="#merge-conflicts" id="toc-merge-conflicts" class="nav-link" data-scroll-target="#merge-conflicts">Merge conflicts</a></li>
  </ul></li>
  <li><a href="#multivariate-newtons-method" id="toc-multivariate-newtons-method" class="nav-link" data-scroll-target="#multivariate-newtons-method">Multivariate Newton’s method</a></li>
  <li><a href="#exercise-branching" id="toc-exercise-branching" class="nav-link" data-scroll-target="#exercise-branching">Exercise: Branching</a></li>
  <li><a href="#exercise-pull-requests-prs" id="toc-exercise-pull-requests-prs" class="nav-link" data-scroll-target="#exercise-pull-requests-prs">Exercise: Pull requests (PRs)</a></li>
  <li><a href="#exercise-code-review" id="toc-exercise-code-review" class="nav-link" data-scroll-target="#exercise-code-review">Exercise: Code review</a></li>
  <li><a href="#exercise-merge-the-pr" id="toc-exercise-merge-the-pr" class="nav-link" data-scroll-target="#exercise-merge-the-pr">Exercise: Merge the PR</a></li>
  </ul></li>
  <li><a href="#numerical-analysis-and-random-number-generation" id="toc-numerical-analysis-and-random-number-generation" class="nav-link" data-scroll-target="#numerical-analysis-and-random-number-generation">8. Numerical analysis and random number generation</a>
  <ul class="collapse">
  <li><a href="#random-number-generation" id="toc-random-number-generation" class="nav-link" data-scroll-target="#random-number-generation">Random number generation</a>
  <ul class="collapse">
  <li><a href="#random-number-seed" id="toc-random-number-seed" class="nav-link" data-scroll-target="#random-number-seed">Random number seed</a></li>
  <li><a href="#random-number-generators" id="toc-random-number-generators" class="nav-link" data-scroll-target="#random-number-generators">Random number generators</a></li>
  </ul></li>
  <li><a href="#floating-point-precision" id="toc-floating-point-precision" class="nav-link" data-scroll-target="#floating-point-precision">Floating point precision</a>
  <ul class="collapse">
  <li><a href="#double-precision-accuracy" id="toc-double-precision-accuracy" class="nav-link" data-scroll-target="#double-precision-accuracy">Double-precision accuracy</a></li>
  <li><a href="#comparisons" id="toc-comparisons" class="nav-link" data-scroll-target="#comparisons">Comparisons</a></li>
  <li><a href="#calculation-errors" id="toc-calculation-errors" class="nav-link" data-scroll-target="#calculation-errors">Calculation errors</a></li>
  <li><a href="#linear-algebra-errors" id="toc-linear-algebra-errors" class="nav-link" data-scroll-target="#linear-algebra-errors">Linear algebra errors</a></li>
  <li><a href="#overflow-and-underflow" id="toc-overflow-and-underflow" class="nav-link" data-scroll-target="#overflow-and-underflow">Overflow and underflow</a></li>
  </ul></li>
  <li><a href="#exercise-forking-and-pull-requests-for-numerical-issues-with-newtons-method" id="toc-exercise-forking-and-pull-requests-for-numerical-issues-with-newtons-method" class="nav-link" data-scroll-target="#exercise-forking-and-pull-requests-for-numerical-issues-with-newtons-method">Exercise: forking and pull requests for numerical issues with Newton’s method</a></li>
  </ul></li>
  <li><a href="#packaging-and-conda-environments" id="toc-packaging-and-conda-environments" class="nav-link" data-scroll-target="#packaging-and-conda-environments">9. Packaging and Conda environments</a>
  <ul class="collapse">
  <li><a href="#packages" id="toc-packages" class="nav-link" data-scroll-target="#packages">Packages</a>
  <ul class="collapse">
  <li><a href="#a-basic-python-package" id="toc-a-basic-python-package" class="nav-link" data-scroll-target="#a-basic-python-package">A basic Python package</a></li>
  <li><a href="#a-minimal-real-package" id="toc-a-minimal-real-package" class="nav-link" data-scroll-target="#a-minimal-real-package">A minimal “real” package</a></li>
  </ul></li>
  <li><a href="#exercise-make-your-own-package" id="toc-exercise-make-your-own-package" class="nav-link" data-scroll-target="#exercise-make-your-own-package">Exercise: Make your own package</a></li>
  <li><a href="#installing-packages" id="toc-installing-packages" class="nav-link" data-scroll-target="#installing-packages">Installing packages</a>
  <ul class="collapse">
  <li><a href="#reproducibility-and-package-management" id="toc-reproducibility-and-package-management" class="nav-link" data-scroll-target="#reproducibility-and-package-management">Reproducibility and package management</a></li>
  <li><a href="#package-locations" id="toc-package-locations" class="nav-link" data-scroll-target="#package-locations">Package locations</a></li>
  <li><a href="#source-vs.-binary-packages" id="toc-source-vs.-binary-packages" class="nav-link" data-scroll-target="#source-vs.-binary-packages">Source vs.&nbsp;binary packages</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#github-actions-and-continuous-integration" id="toc-github-actions-and-continuous-integration" class="nav-link" data-scroll-target="#github-actions-and-continuous-integration">10. GitHub Actions and Continuous Integration</a>
  <ul class="collapse">
  <li><a href="#docker-containers" id="toc-docker-containers" class="nav-link" data-scroll-target="#docker-containers">Docker containers</a></li>
  <li><a href="#example-1-binder" id="toc-example-1-binder" class="nav-link" data-scroll-target="#example-1-binder">Example 1: Binder</a></li>
  <li><a href="#example-2-github-actions-for-automated-testing" id="toc-example-2-github-actions-for-automated-testing" class="nav-link" data-scroll-target="#example-2-github-actions-for-automated-testing">Example 2: GitHub Actions for automated testing</a>
  <ul class="collapse">
  <li><a href="#joint-demoexercise" id="toc-joint-demoexercise" class="nav-link" data-scroll-target="#joint-demoexercise">Joint demo/exercise</a></li>
  </ul></li>
  <li><a href="#example-3-github-actions-for-publishing-webpages" id="toc-example-3-github-actions-for-publishing-webpages" class="nav-link" data-scroll-target="#example-3-github-actions-for-publishing-webpages">Example 3: GitHub Actions for publishing webpages</a>
  <ul class="collapse">
  <li><a href="#configuring-github-pages" id="toc-configuring-github-pages" class="nav-link" data-scroll-target="#configuring-github-pages">Configuring GitHub Pages</a></li>
  <li><a href="#quarto-based-websites" id="toc-quarto-based-websites" class="nav-link" data-scroll-target="#quarto-based-websites">Quarto-based websites</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#feedback-survey" id="toc-feedback-survey" class="nav-link" data-scroll-target="#feedback-survey">Feedback survey</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../units/comp-practices.html">Modules</a></li><li class="breadcrumb-item"><a href="../units/additional-topics.html">Numerics and Reproducibility</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Numerics, reproducibility, and automation</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overview
</div>
</div>
<div class="callout-body-container callout-body">
<p>This module presents some information on numerical analysis (random number generation and floating point precision), packaging, reproducibility, and automation.</p>
</div>
</div>
<section id="multi-user-git" class="level1">
<h1>7. Multi-user Git</h1>
<p>Once you are working on more complicated projects and particularly when working with multiple people, you’ll want to be able to use branches and pull requests (PRs) to manage the work.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Why use branches and pull requests?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Experiment without worrying about breaking the current code.</li>
<li>Test your code before finalizing changes (particularly with testing via continuous integration / GitHub Actions).</li>
<li>Organize aspects of the project for clarity and collaboration.</li>
<li>Manage collaboration:
<ul>
<li>Manage code contributions from others.</li>
<li>Discuss changes.</li>
<li>Keep track of changes.</li>
<li>Accept external contributions.</li>
<li>Resolve conflicts between different changes.</li>
</ul></li>
</ul>
</div>
</div>
</div>
<p>Before going further, let’s review our visualization of working with Git (<a href="https://docs.google.com/presentation/d/1YlM3boYLE8DwbxGNO3ZVVt3e9gEoBgD1uc9RtItUYCU">online version</a>, <a href="git_visuals.pdf">PDF version</a>)</p>
<section id="demo-branching-and-pull-requests-merge-conflicts" class="level2">
<h2 class="anchored" data-anchor-id="demo-branching-and-pull-requests-merge-conflicts">Demo: Branching and pull requests, merge conflicts</h2>
<p>We’ll demo the use of branching and PRs by fixing our <code>optimize</code> function.</p>
<section id="branching" class="level3">
<h3 class="anchored" data-anchor-id="branching">Branching</h3>
<p>First, let’s fix the error in our function in a new branch.</p>
<p>We’ll first (create and) switch to the new branch:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> switch <span class="at">-c</span> fix_initial_bugs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We’ll now make the fixes and do the linting (not shown).</p>
<p>Push the branch with the fix to GitHub.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add newton.py</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span><span class="st">'Fix initial bugs:</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">- derivative interval too small</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">- stopping criterion logic incorrect</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">- copy-paste duplication'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin fix_initial_bugs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="pull-requests" class="level3">
<h3 class="anchored" data-anchor-id="pull-requests">Pull requests</h3>
<p>Now we’ll go to GitHub and start a pull request (PR).</p>
<p>Since we’re the ones who control the repo, we’ll also review and merge in the PR.</p>
</section>
<section id="merge-conflicts" class="level3">
<h3 class="anchored" data-anchor-id="merge-conflicts">Merge conflicts</h3>
<p>Next let’s see a basic example of a <em>merge conflict</em>, which occurs when two commits modify (which could include deletion) the same line in a file. In this case Git requires the user to figure out what should be done.</p>
<p>To get an example, we need to create a conflict. I will add different documentation in the <code>main</code> and <code>fix_initial_bugs</code> branches. After pushing the <code>main</code> change, I’ll try to do a PR with the <code>fix_initial_bugs</code>.</p>
<p>The GitHub UI does a nice job of helping you resolve merge conflicts, as we’ll see.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Resolving conflicts at the command line
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can also get (and resolve) merge conflicts on the command line. Git will add some syntax to the conflicted file pointing out the conflicts that need to be resolved. Once you edit the conflicted file to fix the conflict, you can do <code>git add &lt;name_of_file&gt;</code> and then <code>git commit</code>.</p>
</div>
</div>
</section>
</section>
<section id="multivariate-newtons-method" class="level2">
<h2 class="anchored" data-anchor-id="multivariate-newtons-method">Multivariate Newton’s method</h2>
<p>Recall that Newton’s method optimizes some objective function, <span class="math inline">\(f(x)\)</span> as a function of univariate or multivariate <span class="math inline">\(x\)</span>, where <span class="math inline">\(f(x)\)</span> is univariate.</p>
<p>The multivariate method extends the univariate, using the gradient (first derivative) vector and Hessian (second derivative) matrix.</p>
<p>If we are at step <span class="math inline">\(t-1\)</span>, the next value is:</p>
<p><span class="math display">\[
x_{t+1}=x_{t}-H_{f}(x_{t})^{-1}\nabla f(x_{t})
\]</span></p>
<p>where <span class="math inline">\(\nabla f(x_{t})\)</span> is the gradient (first derivative with respect to each element of <span class="math inline">\(x\)</span>) and <span class="math inline">\(H_{f}(x_{t})\)</span> is the Hessian matrix (second derivatives with respect to all pairs of the elements of <span class="math inline">\(x\)</span>).</p>
<p>Here are the steps:</p>
<ul>
<li>determine a starting value, <span class="math inline">\(x_0\)</span>.</li>
<li>iterate:
<ul>
<li>at step <span class="math inline">\(t\)</span>, the next value (the update) is given by the equation above</li>
<li>stop when <span class="math inline">\(\left\Vert x_{t} - x_{t-1} \right\Vert\)</span> is “small”</li>
</ul></li>
</ul>
</section>
<section id="exercise-branching" class="level2">
<h2 class="anchored" data-anchor-id="exercise-branching">Exercise: Branching</h2>
<ol type="1">
<li>Make sure you’ve committed your tests and any changes made to your univariate Newton’s method to your <code>main</code> branch. And make sure you push the changes to GitHub.</li>
<li>Make a branch (called <code>multivariate</code>) in which you’ll implement the multivariate version of Newton’s method (see details above)</li>
<li>Implement the algorithm, either in <code>newton.py</code> or in a new file if you prefer.</li>
</ol>
<p>You may need to search online for how to calculate <span class="math inline">\(H_{f}(x_{t})^{-1}\nabla f(x_{t})\)</span>.</p>
<p>At this point, if we think about calculating the Hessian it starts to feel more tedious to deal with the finite difference calculations, though it is a straightforward extension of what you already implemented. Feel free to look online to find a Python package that implements finite difference estimation of derivatives and use that in your code (see what Google indicates or if you use a ChatBot/LLM what they suggest).</p>
<p>As you are writing the code, you can continue to think about what might go wrong and include defensive programming tactics.</p>
</section>
<section id="exercise-pull-requests-prs" class="level2">
<h2 class="anchored" data-anchor-id="exercise-pull-requests-prs">Exercise: Pull requests (PRs)</h2>
<p>When you have your branch ready, make a pull request:</p>
<ol type="1">
<li><p>Make a pull request into the remote for the repository by pushing the branch to GitHub</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin multivariate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Go to GitHub to the <code>Pull requests</code> tab and make the PR, making a note of what the PR is about.</p></li>
</ol>
<p>Don’t (yet) merge in the PR. We want someone else to review it to have additional eyes on the code.</p>
</section>
<section id="exercise-code-review" class="level2">
<h2 class="anchored" data-anchor-id="exercise-code-review">Exercise: Code review</h2>
<p>Now find a partner.</p>
<p>Give the partner the URL for your repository on GitHub and ask them to look at the PR. In turn get the URL for their repository.</p>
<p>In reviewing the PR, make comments in the PR comment/conversation area on GitHub.</p>
<p>If you have time, explore these two additional options for making comments:</p>
<ol type="1">
<li>Review changes:
<ul>
<li>Click on the <code>Files changed</code> tab (or go to <code>https://github.com/&lt;USERNAME&gt;/newton-practice/pull/&lt;PULL_ID&gt;/files</code> for the specific “PULL_ID”).</li>
<li>Click on the <code>Review changes</code> button.</li>
</ul></li>
<li>Make comments on specific lines
<ul>
<li>Click on the <code>Files changed</code> tab (or go to <code>https://github.com/&lt;USERNAME&gt;/newton-practice/pull/&lt;PULL_ID&gt;/files</code> for the specific “PULL_ID”).</li>
<li>Hover over a specific line in a specific file with your mouse. A blue “plus” box should appear. Click on the plus to add a comment.</li>
<li>Click on <code>Add single comment</code> or optionally experiment with <code>Start a review</code>.</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Code review guidelines">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code review guidelines
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1012375">This article</a> gives tips on how to do good code review (and how to set up projects to facilitate good reviewing).</p>
</div>
</div>
</section>
<section id="exercise-merge-the-pr" class="level2">
<h2 class="anchored" data-anchor-id="exercise-merge-the-pr">Exercise: Merge the PR</h2>
<p>Once you’ve seen the review by your partner:</p>
<ul>
<li>On DataHub, make changes to the branch that was used in the pull request. Then commit and push to GitHub.
<ul>
<li>Alternatively, you could make the changes directly on GitHub using its editing capabilities.</li>
</ul></li>
<li>On GitHub, merge in the (now revised) pull request and close the request.
<ul>
<li>You may want to delete the branch. This helps avoid having a profusion of unneeded branches.</li>
</ul></li>
<li>On DataHub, run <code>git pull</code> to get the changes updated in the <code>main</code> branch of your local repository.</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The full cycle of “git virtue”
</div>
</div>
<div class="callout-body-container callout-body">
<p>Congratulations. In the course of yesterday and this morning, you’ve worked through the steps of a complete, albeit small, project using an extensive set of concepts, skills, and tools used in real world projects.</p>
</div>
</div>
</section>
</section>
<section id="numerical-analysis-and-random-number-generation" class="level1">
<h1>8. Numerical analysis and random number generation</h1>
<section id="random-number-generation" class="level2">
<h2 class="anchored" data-anchor-id="random-number-generation">Random number generation</h2>
<p>Random numbers on a computer are actually (periodic) deterministic sequences that (hopefully) behave as if they were random.</p>
<section id="random-number-seed" class="level3">
<h3 class="anchored" data-anchor-id="random-number-seed">Random number seed</h3>
<p>The <em>seed</em> determines where in the cycle of the periodic sequence you are.</p>
<p>It’s critical for ensuring reproducibility when running code that uses random numbers</p>
<div id="248312a5" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>array([ 1.62434536, -0.61175641, -0.52817175, -1.07296862,  0.86540763])</code></pre>
</div>
</div>
<div id="219059a1" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>array([-2.3015387 ,  1.74481176, -0.7612069 ,  0.3190391 , -0.24937038])</code></pre>
</div>
</div>
<div id="b2d886d7" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>array([ 1.62434536, -0.61175641, -0.52817175, -1.07296862,  0.86540763,
       -2.3015387 ,  1.74481176, -0.7612069 ,  0.3190391 , -0.24937038])</code></pre>
</div>
</div>
</section>
<section id="random-number-generators" class="level3">
<h3 class="anchored" data-anchor-id="random-number-generators">Random number generators</h3>
<p>If you don’t do anything, numpy will use a generator called the Mersenne Twister (that’s the default in R too).</p>
<p>However the “default” RNG in numpy is a newer, better algorithm called PCG64.</p>
<div id="2bc2f1bd" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Mersenne twister</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>array([ 1.62434536, -0.61175641, -0.52817175, -1.07296862,  0.86540763])</code></pre>
</div>
</div>
<div id="3d5e7033" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Mersenne twister, selected specifically</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.Generator(np.random.MT19937(seed <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">## Not clear why numbers differ from above. Seed setup might differ.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>array([ 2.04676909, -1.03653009,  0.72997546,  0.41584996, -0.1922969 ])</code></pre>
</div>
</div>
<div id="5b05645d" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">## 'Default' PCG64</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.Generator(np.random.PCG64(seed <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array([ 0.34558419,  0.82161814,  0.33043708, -1.30315723,  0.90535587])</code></pre>
</div>
</div>
<div id="4b13b850" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<pre><code>array([ 0.34558419,  0.82161814,  0.33043708, -1.30315723,  0.90535587])</code></pre>
</div>
</div>
<p>Some cautions (<a href="https://arxiv.org/pdf/1810.10985">detailed by Philip Stark and Kellie Ottoboni</a>):</p>
<ul>
<li>seeds with many zeros can be problematic.</li>
<li>Mersenne Twister not as good as PCG64.</li>
<li>Be particularly cautious to use a good RNG when doing permutation and taking random samples.</li>
</ul>
</section>
</section>
<section id="floating-point-precision" class="level2">
<h2 class="anchored" data-anchor-id="floating-point-precision">Floating point precision</h2>
<div id="a66fbe00" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.1</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fl">0.2</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="co"># Hmmm...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>0.1</code></pre>
</div>
</div>
<section id="double-precision-accuracy" class="level3">
<h3 class="anchored" data-anchor-id="double-precision-accuracy">Double-precision accuracy</h3>
<p>Numbers in most languages are stored by default as double precision floating point numbers.</p>
<ul>
<li>8 bytes = 64 bits = double precision</li>
<li>4 bytes = 32 bits = single precision</li>
</ul>
<p>(GPU libraries often use 4 bytes or even fewer, or a mix of precisions.)</p>
<div id="f847f6db" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dg(x, form <span class="op">=</span> <span class="st">'.20f'</span>):</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">format</span>(x, form))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>dg(a)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>dg(b)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>dg(a<span class="op">-</span>b)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>dg(<span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>0.29999999999999998890
0.20000000000000001110
0.09999999999999997780
0.10000000000000000555</code></pre>
</div>
</div>
<p>How many digits of accuracy do we have?</p>
<p>Same thing regardless of the size of the number:</p>
<div id="65f29dfc" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678.1234567812345678</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>12345678.123456782</code></pre>
</div>
</div>
<div id="8b5ca125" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678123456781234.5678</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<pre><code>1.234567812345678e+19</code></pre>
</div>
</div>
<div id="f054fbff" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dg(<span class="fl">12345678123456781234.5678</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>12345678123456780288.00000000000000000000</code></pre>
</div>
</div>
<p>This occurs because of how the 64 bits in a double precision floating point number are allocated to give a large range of numbers in terms of magnitude and high precision in terms of digits of accuracy.</p>
</section>
<section id="comparisons" class="level3">
<h3 class="anchored" data-anchor-id="comparisons">Comparisons</h3>
<p>Let’s see what kinds of numbers we can safely compare for exact equality with <code>==</code>.</p>
<div id="bd263233" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">1.5</span> <span class="op">-</span> <span class="fl">.2</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.5</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span>  <span class="op">-</span><span class="fl">.3</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> (<span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span>) <span class="op">-</span> (<span class="fl">.51</span> <span class="op">-</span> <span class="fl">.21</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>np.isclose(x, <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculation-errors" class="level3">
<h3 class="anchored" data-anchor-id="calculation-errors">Calculation errors</h3>
<p>Let’s consider accuracy of subtraction.</p>
<div id="af317b60" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1234</span> <span class="op">-</span> <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>0.12339999999999995</code></pre>
</div>
</div>
<div id="be65d537" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fl">123456781234.1234</span> <span class="op">-</span> <span class="fl">123456781234.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>0.1233978271484375</code></pre>
</div>
</div>
<p>This is called catastrophic cancellation.</p>
<p>Do you think calling it “catastrophic” is too extreme? If so, consider this.</p>
<div id="52076ab9" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fl">81.0</span> <span class="op">-</span> <span class="fl">80.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>1.0</code></pre>
</div>
</div>
<div id="a03f7380" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678123456781.0</span> <span class="op">-</span><span class="fl">12345678123456780.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>0.0</code></pre>
</div>
</div>
<p>What’s the derivative of <span class="math inline">\(sin(x)\)</span>? Let’s see what kind of accuracy we can get.</p>
<div id="a34a4b27" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deriv(f, x, eps<span class="op">=</span><span class="fl">1e-8</span>):</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> (f(x<span class="op">+</span>eps) <span class="op">-</span> f(x)) <span class="op">/</span> eps</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>np.cos(<span class="fl">0.2</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-12</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-14</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-15</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-16</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-17</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="linear-algebra-errors" class="level3">
<h3 class="anchored" data-anchor-id="linear-algebra-errors">Linear algebra errors</h3>
<p>The errors seen in doing calculations, such as catastrophic cancellation, cascaded through derivative estimation. That also happens when doing linear algebra operations.</p>
<p>Here’s an example where mathematically all the eigenvalues are real-valued and positive, but not on the computer.</p>
<div id="06e6479e" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> np.<span class="bu">abs</span>(xs[:, np.newaxis] <span class="op">-</span> xs)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a p.d. matrix (mathematically).</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> np.exp(<span class="op">-</span>(dists<span class="op">/</span><span class="dv">10</span>)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># But not numerically...</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>sp.linalg.eigvals(corr_matrix)[<span class="dv">80</span>:<span class="dv">99</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>array([-2.37723598e-16-4.91007317e-17j, -1.60127636e-16+1.17949719e-16j,
       -1.60127636e-16-1.17949719e-16j, -7.41352595e-17+1.66220142e-16j,
       -7.41352595e-17-1.66220142e-16j, -1.76637300e-16+0.00000000e+00j,
        7.09195283e-17+1.28507648e-16j,  7.09195283e-17-1.28507648e-16j,
       -1.13567902e-16+6.88023195e-17j, -1.13567902e-16-6.88023195e-17j,
        1.72642191e-16+0.00000000e+00j,  8.72849684e-17+8.73803536e-17j,
        8.72849684e-17-8.73803536e-17j, -1.18143934e-16+0.00000000e+00j,
       -3.43612923e-17+5.30456202e-17j, -3.43612923e-17-5.30456202e-17j,
        4.61858826e-17+6.09144793e-17j,  4.61858826e-17-6.09144793e-17j,
        2.75968689e-17+2.68286830e-17j])</code></pre>
</div>
</div>
</section>
<section id="overflow-and-underflow" class="level3">
<h3 class="anchored" data-anchor-id="overflow-and-underflow">Overflow and underflow</h3>
<p>Having a finite number of bits to represent each number means there are minimum and maximum numbers that can be expressed.</p>
<div id="12b4c2af" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.38e5000</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.38e-400</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>0.0</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
How much do we need to worry about overflow and underflow?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Q: Roughly how many observations would it take before we underflow in calculating a likelihood?</p>
<ul>
<li>10</li>
<li>100</li>
<li>1000</li>
<li>100000</li>
<li>100000000</li>
</ul>
</div>
</div>
<div id="e904c9de" class="cell" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.normal(size<span class="op">=</span>n)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>np.prod(sp.stats.norm.pdf(x))</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>loglik <span class="op">=</span> np.<span class="bu">sum</span>(sp.stats.norm.logpdf(x))</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>loglik</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>np.exp(loglik)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>np.float64(2.0739518337814167e-08)</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Work with probabilities and densities on the log scale. Almost always.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
</section>
</section>
<section id="exercise-forking-and-pull-requests-for-numerical-issues-with-newtons-method" class="level2">
<h2 class="anchored" data-anchor-id="exercise-forking-and-pull-requests-for-numerical-issues-with-newtons-method">Exercise: forking and pull requests for numerical issues with Newton’s method</h2>
<p>Look at your partner’s code in terms of how it handles the stopping criterion or (for the 1-d case) the finite difference estimate of the gradient and Hessian.</p>
<p>Fork your partner’s repository. In the local version of that repository on your DataHub, make a change to try to improve how the stopping criterion or finite difference estimate is handled. Then make a pull request back into your partner’s repository.</p>
<p>Here are the detailed steps of how to do all that:</p>
<ol type="1">
<li>Go to your partner’s GitHub page and fork the repository (<code>https://github.com/&lt;username&gt;/newton-practice/fork</code>). You can name it <code>newton-practice-&lt;partner_name&gt;</code> or something else.</li>
<li>On DataHub, clone the forked repository: <code>git clone https://github.com/&lt;your_username&gt;/newton-practice-&lt;partner_name&gt;</code>.</li>
<li>On DataHub, enter the directory of the cloned repository: <code>cd newton-practice-&lt;partner_name&gt;</code>.</li>
<li>Make a branch, make changes, add, and commit.</li>
<li>Give DataHub access to the new repository via <a href="https://berkeley-scf.github.io/compute-skills-2025/prep.html#give-access-to-the-specific-github-repository-you-are-working-with">Step 3 of the steps for accessing GitHub repository from DataHub</a>.</li>
<li>Push the commit to your GitHub: <code>git push -u origin newton-practice-&lt;partner_name&gt;</code>.</li>
<li>Go to <code>https://github.com/&lt;your_username&gt;/newton-practice-&lt;partner_name&gt;</code> and open a pull request (“Compare and pull request”) with the new branch. The request will automatically be done in the GitHub account of your partner.</li>
</ol>
<p>Then review the pull request your partner makes in your own repository. Iterate with your partner until you are happy to merge the pull request into your repository. Remember to then run <code>git pull</code> to get the changes in the local copy of the repository.</p>
</section>
</section>
<section id="packaging-and-conda-environments" class="level1">
<h1>9. Packaging and Conda environments</h1>
<section id="packages" class="level2">
<h2 class="anchored" data-anchor-id="packages">Packages</h2>
<p>What’s a package? In general it is software that is provided as a bundle that can be downloaded and made available on your computer. Some packages (e.g., R, Python themselves) are stand-alone packages. Others (such as R packages and Python packages) are add-on functionality that works with and extends the functionality of the stand-alone software.</p>
<p>What do we need to have a Python package?</p>
<section id="a-basic-python-package" class="level3">
<h3 class="anchored" data-anchor-id="a-basic-python-package">A basic Python package</h3>
<p>A Python package is a directory containing one or more modules and with a file named <code>__init__.py</code> that is called when a package is imported and serves to initialize the package.</p>
<p>Let’s create a basic package.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> mypkg</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> mypkg/__init__.py</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="st">## Make objects from mymod.py available as </span><span class="kw">`</span><span class="ex">mypkg.object_name</span><span class="kw">`</span>.</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="st">from mypkg.mymod import *</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="st">print("Welcome to my package.")</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> mypkg/mymod.py</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="st">x = 7</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="st">def myfun(val):</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="st">    print("The arg is: ", str(val), ".", sep = '')</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that if there were other modules (i.e., Python code files), we could have imported from those as well.</p>
<p>Now we can use the objects from the package without having to know that it was in a particular module (because of how <code>__init__.py</code> was set up).</p>
<div id="7c880b27" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mypkg</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>mypkg.x</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>mypkg.myfun(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that one can set <code>__all__</code> in an <code>__init__.py</code> to define what is imported, which makes clear what is publicly available and hides what is considered internal.</p>
</section>
<section id="a-minimal-real-package" class="level3">
<h3 class="anchored" data-anchor-id="a-minimal-real-package">A minimal “real” package</h3>
<p>Fernando has a <a href="https://github.com/fperez/mytoy">this toy example package</a>.</p>
<p>Let’s clone the repository and see if we can install it.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/fperez/mytoy</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mytoy</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--user</span> .</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> .local/lib/python3.11/site-packages</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="7a09f224" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mytoy</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>mytoy.toy(<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s look in the top directory of the repository. There we see various files related to building and installing the package, namely, <code>pyproj.toml</code>, <code>setup.py</code>, <code>setup.cfg</code>, etc.</p>
<p>In fact, one can install the package with only either <code>setup.py</code> or <code>pyproj.toml</code>, but the other files listed here are recommended:</p>
<ul>
<li><code>pyproj.toml</code> (or <code>pyproject.toml</code>): this is a configuration file used by packaging tools. In the <code>mytoy</code> example it specifies to use <code>setuptools</code> to build and install the package.</li>
<li><code>setup.py</code>: this is run when the package is built and installed when using <code>setuptools</code>. In the example, it simply runs <code>setuptools.setup()</code>. With recent versions of <code>setuptools</code>, you don’t actually need this so long as you have the <code>pyproj.toml</code> file.</li>
<li><code>setup.cfg</code>: provides metadata about the package when using <code>setuptools</code>.</li>
<li><code>environment.yml</code>: provides information about the full environment in which your package should be used (including examples, documentation, etc.). For projects using <code>setuptools</code>, a minimal list of dependencies needed for installation and use of the package can instead be included in the <code>install_requires</code> option of <code>setup.cfg</code>.</li>
<li><code>LICENSE</code>: specifies the license for your package giving the terms under which others can use it.</li>
</ul>
<p>The <code>postBuild</code> file is a completely optional file only needed if you want to use the package with a MyBinder environment.</p>
<p>At the <a href="https://github.com/numpy/numpy">numpy GitHub repository</a>, by looking in <code>pyproject.toml</code>, you can see that <code>numpy</code> is build and installed using a system called <em>Meson</em>, while at the <a href="https://github.com/jupyter/jupyter">Jupyter GitHub repository</a> you can see that the <code>jupyter</code> package is built and installed using <code>setuptools</code>.</p>
<p><em>Building</em> a package usually refers to compiling source code but for a Python package that just has Python code, nothing needs to be compiled. <em>Installing</em> a package means putting the built package into a location on your computer where packages are installed.</p>
<p>It would take more work to make the package available in a repository such as PyPI or via Conda.</p>
</section>
</section>
<section id="exercise-make-your-own-package" class="level2">
<h2 class="anchored" data-anchor-id="exercise-make-your-own-package">Exercise: Make your own package</h2>
<p>Make a package out of your Newton method code, following the structure of <code>mytoy</code>. Include your tests as part of the package.</p>
<p>See if you can install your package, run the tests, and use the package, following the <code>README.md</code> of <code>mytoy</code>.</p>
</section>
<section id="installing-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-packages">Installing packages</h2>
<p>If a package is on PyPI or available through Conda but not on your system, you can install it easily (usually). You don’t need root permission on a machine to install a package, though you may need to use <code>pip install --user</code> or set up a new Conda environment.</p>
<p>Packages often depend on other packages. In general, if one package depends on another, pip or conda will generally install the dependency automatically.</p>
<p>One advantage of Conda is that it can also install non-Python packages on which a Python package depends, whereas with pip you sometimes need to install a system package to satisfy a dependency.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Faster installation with Mamba
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s not uncommon to run into a case where conda has trouble installing a package because of version inconsistencies amongst the dependencies. <code>mamba</code> is a drop-in replacement for <code>conda</code> and often does a better job of this “dependency resolution”. <a href="https://statistics.berkeley.edu/computing/software/install">We use <code>mamba</code> by default on the SCF</a>.</p>
<p>With newer versions of Conda, you can use the <code>libmamba</code> dependency “resolver” by running <code>conda config --set solver libmamba</code>, which adds <code>solver: libmamba</code> to your <code>.condarc</code> file.</p>
</div>
</div>
<section id="reproducibility-and-package-management" class="level3">
<h3 class="anchored" data-anchor-id="reproducibility-and-package-management">Reproducibility and package management</h3>
<p>For reproducibility, it’s important to know the versions of the packages you use (and the version of Python). <code>pip</code> and <code>conda</code> make it easy to do this. You can create a <em>requirements</em> file that captures the packages you are currently using (and, critically, their versions) and then install exactly that set of packages (and versions) based on that requirements file.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Reproducing using pip.</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> freeze <span class="op">&gt;</span> requirements.txt</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">## Reproducing a Conda environment.</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> environment.yml</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> environment.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Conda is a general package manager. You can use it to manage Python packages but lots of other software as well, including R and Julia.</p>
<section id="fully-isolating-your-conda-environment" class="level4">
<h4 class="anchored" data-anchor-id="fully-isolating-your-conda-environment">Fully isolating your Conda environment</h4>
<p>Conda environments provide an additional layer of modularity/reproducibility, allowing you to set up a fully reproducible environment for your computation. Here (by explicitly giving <code>python=3.11</code>) the Python 3.11 executable and all packages you install in the environment are fully independent of whatever Python executables are installed on the system. (That said, there are <a href="https://statistics.berkeley.edu/computing/software/install#conda-isolate">some caveats</a> that can make it a bit of headache to ensure full isolation.)</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> python</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-n</span> my_iso_env python=3.11</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> activate my_iso_env</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> python</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install numpy</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">## (Optionally) saving the recipe:</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> my_iso_env.yml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Activating an environment
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you use <code>conda activate</code> rather than <code>source activate</code>, Conda will prompt you to run <code>conda init</code>, which will make changes to your <code>~/.bashrc</code> that, for one, activate the Conda base environment automatically when a shell is started. This may be fine, but it’s helpful to be aware.</p>
</div>
</div>
</section>
</section>
<section id="package-locations" class="level3">
<h3 class="anchored" data-anchor-id="package-locations">Package locations</h3>
<p>Packages in Python (and in R, Julia, etc.) may be installed in various places on the filesystem, and it sometimes it is helpful (e.g., if you end up with multiple versions of a package installed on your system) to be able to figure out where on the filesystem the package is being loaded from.</p>
<ul>
<li><code>pkgname.__file__</code> will show where the imported package is installed.</li>
<li><code>pkname.__version__</code> will show the version of the package (as will <code>pip list</code> or <code>conda list</code>, for all packages).</li>
<li><code>sys.path</code> shows where Python looks for packages on your system.
<ul>
<li>packages installed via <code>pip</code> will generally be in <code>~/.local/lib/python3.X/site-packages</code>.</li>
</ul></li>
</ul>
<p>Let’s check that <code>numpy</code> got installed into the <code>my_iso_env</code> environment where we expect it to be.</p>
<div id="4dc33ae7" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>numpy.<span class="va">__file__</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="source-vs.-binary-packages" class="level3">
<h3 class="anchored" data-anchor-id="source-vs.-binary-packages">Source vs.&nbsp;binary packages</h3>
<p>The difference between a <em>source</em> package and a <em>binary</em> package is that</p>
<ul>
<li>a <em>source</em> package has the raw Python (and C/C++ and Fortran, in some cases) code as text files</li>
<li>a <em>binary</em> package has all the non-Python code in a binary/non-text format, with the C/C++ and Fortran code already having been compiled.</li>
</ul>
<p>If you install a package from source, C/C++/Fortran code will be compiled on your system (if the package has such code). That should mean the compiled code will work on your system, but requires you to have a compiler available and things properly configured. A binary package doesn’t need to be compiled on your system, but in some cases (e.g., if you got the wrong binary version) the code may not run on your system because it was compiled in such a way that is not compatible with your system.</p>
<p>Python <em>wheels</em> are a binary package format for Python packages. Wheels for some packages will vary by platform (i.e., operating system) so that the package will install correctly on the system where it is being installed.</p>
</section>
</section>
</section>
<section id="github-actions-and-continuous-integration" class="level1">
<h1>10. GitHub Actions and Continuous Integration</h1>
<p>Having reproducible environments (e.g., Conda environments or Docker containers) provides the ability to run (and automate) various actions to run on remote/cloud computational resources and know that they (should) work.</p>
<section id="docker-containers" class="level2 {callout-tip}">
<h2 class="anchored" data-anchor-id="docker-containers">Docker containers</h2>
<p>Docker containers share some similarities with Conda environments except that you provide a full specification for the Linux operating system you want to use and software you want installed.</p>
</section>
<p>You need to provide the recipe for the environment or container. The automation system can then set up the environment as a virtual environment/container on the remote machine and run the action/code you request. This could simply be giving you a terminal or starting a Jupyter notebook in the environment and giving you access via your browser.</p>
<p>In this section, we’ll show some examples of automation with reproducible environments.</p>
<p>There are a lot more out there. In fact, DataHub is based on Docker containers (and a container management service called Kubernetes). Let’s see what operating system is being run in the container that your DataHub server is using.</p>
<pre><code>$ cat /etc/issue
Ubuntu 22.04.4 LTS \n \l</code></pre>
<p>This is all quite powerful, and the use of reproducible environments generally helps with debugging because you can also set up the environment on your own machine. That said, running code remotely or in the cloud can also be hard to debug at times.</p>
<section id="example-1-binder" class="level2">
<h2 class="anchored" data-anchor-id="example-1-binder">Example 1: Binder</h2>
<p>One example is using Binder to open a Jupyter notebook in an executable environment.</p>
<p>Based on a configuration (various options are possible for how to specify the configuration), Binder will create a Docker container with the needed software installed.</p>
<p>The most common configuration format is to provide a Conda environment file. Binder will then create a Conda environment inside the Docker (Linux) container. The Conda environment will contain the packages specified in the environment file.</p>
<p>Let’s set up a Binder environment “Geospatial analytics in Python with Geopandas” that can access the <a href="https://github.com/jorisvandenbossche/geopandas-tutorial">notebooks and materials provided in the repository</a> in a <a href="https://github.com/jorisvandenbossche/geopandas-tutorial/blob/main/environment.yml">computational environment</a> designed to use the notebooks reliably and reproducibly.</p>
<p>In some cases an <em>image</em> for the container will already be available, and all that needs to happen is to start a virtual machine using that image as the computational environment. In other cases (e.g., with a configuration you’ve just created), the Docker container and Conda environment need to be set up.</p>
<p>If we’re familiar with what happens when Docker containers and Conda environments are set up, we can see in the Binder logs that a Docker container is set up (using Ubuntu Linux) and one of the steps of doing that is to create a Conda environment within the container.</p>
<p>Let’s see the steps that are run if we use the <code>mytoy</code> repository to start a Binder environment at <code>ovh.mybinder.org</code>, specifying <code>fperez/mytoy</code> as the repository. (Note that in a number of cases, the startup has failed, probably because <code>mybinder</code> has very limited resources for providing cloud compute resources. We are using <code>ovh.mybinder.org</code> rather than <code>mybinder.org</code> in hopes that is more likely to succeed.</p>
</section>
<section id="example-2-github-actions-for-automated-testing" class="level2">
<h2 class="anchored" data-anchor-id="example-2-github-actions-for-automated-testing">Example 2: GitHub Actions for automated testing</h2>
<p>A second example is using GitHub Actions (GHA) to automate activities such as testing. To set up a GitHub Actions workflow, one</p>
<ul>
<li>specifies when the workflow will run (e.g., when a push or pull request is made, or only manually)</li>
<li>provides instructions for how to set up the environment for the workflow</li>
<li>provides the operations that the workflow should run.</li>
</ul>
<p>A good example is running tests whenever you make a commit to a repository containing software.</p>
<p>With GHA, you specify the operating system and then run the steps you specify in <code>.github/workflows/some_action.yml</code>. Some steps will customize the environment as the initial steps and then additional step(s) will run shell or other code to run your workflow. You use pre-specified operations (called <em>actions</em>) to do common things (such as checking out a GitHub repository and installing commonly used software).</p>
<p>When triggered, GitHub will run the steps in a virtual machine, which is called the <em>runner</em>.</p>
<section id="joint-demoexercise" class="level3">
<h3 class="anchored" data-anchor-id="joint-demoexercise">Joint demo/exercise</h3>
<p>We’ll walk through the steps of setting up automated testing for the <code>mytoy</code> example package. Why do this? It’s common to have testing pass locally on your own machine, but fail for various reasons when done elsewhere.</p>
<p>The workflow is specified using a YAML file placed in the <code>.github/workflows</code> directory of the repository.</p>
<p>Here’s an example YAML file for testing the <code>mytoy</code> package:</p>
<pre><code>on:
  push:
    branches:
    - main

jobs:
  CI:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4

    # Install dependencies
    - name: Set up Python 
      uses: actions/setup-python@v5
      with:
        python-version: 3.12

    - name: Install mytoy
      run: |
        # There is a small bug here.
        cd mytoy
        pip install --user .

    - name: Run tests
      run: |
        # Another small bug here.
        cd mytoy
        pytest</code></pre>
<p>We’ll first run this with the current tests for <code>mytoy</code>, which should pass when run via GitHub Actions. We can take a look at <a href="https://github.com/fperez/mytoy/actions">the output</a>.</p>
<p>Next, let’s introduce a failing test to see what the output looks like and get a sense for how to debug it.</p>
</section>
</section>
<section id="example-3-github-actions-for-publishing-webpages" class="level2">
<h2 class="anchored" data-anchor-id="example-3-github-actions-for-publishing-webpages">Example 3: GitHub Actions for publishing webpages</h2>
<p>We can use GitHub Actions with GitHub pages to easily publish websites, where we make changes to the repository and the workflow causes the website to be updated.</p>
<p>Here’s the <a href="https://github.com/UCB-stat-159-s23/site/blob/main/.github/workflows/book.yml">GitHub Actions workflow (a YAML file)</a> that publishes the website for the spring 2023 version of Statistics 159/259. Any commits made in the <code>main</code> branch cause the website to be updated.</p>
<section id="configuring-github-pages" class="level3">
<h3 class="anchored" data-anchor-id="configuring-github-pages">Configuring GitHub Pages</h3>
<p>To set up GitHub Pages for a repository, go to <code>https://github.com/github_org/repository/settings/pages</code> and select <code>Source -&gt; Deploy from a branch</code> and then choose <code>gh-pages</code> as the branch (first creating the <code>gh-pages</code> branch if necessary). The website should appear at <code>github_org.github.io/repository</code>.</p>
</section>
<section id="quarto-based-websites" class="level3">
<h3 class="anchored" data-anchor-id="quarto-based-websites">Quarto-based websites</h3>
<p>In fact the website for this workshop was done using Quarto, which uses GitHub Pages and GitHub Actions behind the scenes.</p>
<p>Chris runs <code>quarto publish gh-pages</code> to update the site. Quarto will (on the local machine) render the html (convert the Markdown to html) and then behind the scenes Quarto uses <a href="https://github.com/berkeley-scf/compute-skills-2025/actions">GitHub Actions</a> and <a href="https://github.com/berkeley-scf/compute-skills-2025/tree/gh-pages">GitHub Pages (via the `gh-pages branch)</a> to publish the website.</p>
</section>
</section>
</section>
<section id="feedback-survey" class="level1">
<h1>Feedback survey</h1>
<p>This is only the second time we’ve done this, so it’s helpful now to get feedback on it. Please fill out this <a href="https://docs.google.com/forms/d/e/1FAIpQLScXrPcjThkfguJ56zbtU_VB8aZ1K5fWBeLaY4GDZNnEve1JJQ/viewform?usp=dialog">brief survey</a>.</p>


<!-- -->

</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/berkeley-scf\.github\.io\/compute-skills-2025");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb53" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Numerics, reproducibility, and automation"</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">    css: ../styles.css</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-copy: true</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-block-background: true</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>This module presents some information on numerical analysis (random number generation and floating point precision), packaging, reproducibility, and automation.</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># 7. Multi-user Git</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>Once you are working on more complicated projects and particularly when working with multiple people, you'll want to be able to use branches and pull requests (PRs) to manage the work.</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip collapse="true"}</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why use branches and pull requests?</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Experiment without worrying about breaking the current code.</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Test your code before finalizing changes (particularly with testing via continuous integration / GitHub Actions).</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Organize aspects of the project for clarity and collaboration.</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Manage collaboration:</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Manage code contributions from others.</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Discuss changes.</span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Keep track of changes.</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Accept external contributions.</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Resolve conflicts between different changes.</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>Before going further, let's review our visualization of working with Git (<span class="co">[</span><span class="ot">online version</span><span class="co">](https://docs.google.com/presentation/d/1YlM3boYLE8DwbxGNO3ZVVt3e9gEoBgD1uc9RtItUYCU)</span>, <span class="co">[</span><span class="ot">PDF version</span><span class="co">](git_visuals.pdf)</span>)</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a><span class="fu">## Demo: Branching and pull requests, merge conflicts</span></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>We'll demo the use of branching and PRs by fixing our <span class="in">`optimize`</span> function.</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="fu">### Branching</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>First, let's fix the error in our function in a new branch.</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>We'll first (create and) switch to the new branch:</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> switch <span class="at">-c</span> fix_initial_bugs</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>We'll now make the fixes and do the linting (not shown).</span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a>Push the branch with the fix to GitHub.</span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> add newton.py</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> commit <span class="at">-m</span><span class="st">'Fix initial bugs:</span></span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a><span class="st">- derivative interval too small</span></span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a><span class="st">- stopping criterion logic incorrect</span></span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a><span class="st">- copy-paste duplication'</span></span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> push <span class="at">-u</span> origin fix_initial_bugs</span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pull requests</span></span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a>Now we'll go to GitHub and start a pull request (PR).</span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a>Since we're the ones who control the repo, we'll also review and merge in the PR.</span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a><span class="fu">### Merge conflicts</span></span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a>Next let's see a basic example of a *merge conflict*, which occurs when two commits modify (which could include deletion) the same line in a file. In this case Git requires the user to figure out what should be done.</span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a>To get an example, we need to create a conflict. I will add different documentation in the <span class="in">`main`</span> and <span class="in">`fix_initial_bugs`</span> branches. After pushing the <span class="in">`main`</span> change, I'll try to do a PR with the <span class="in">`fix_initial_bugs`</span>.</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a>The GitHub UI does a nice job of helping you resolve merge conflicts, as we'll see.</span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a><span class="fu">## Resolving conflicts at the command line</span></span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a>You can also get (and resolve) merge conflicts on the command line. Git will add some syntax to the conflicted file pointing out the conflicts that need to be resolved. Once you edit the conflicted file to fix the conflict, you can do <span class="in">`git add &lt;name_of_file&gt;`</span> and then <span class="in">`git commit`</span>.</span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a><span class="fu">## Multivariate Newton's method</span></span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a>Recall that Newton's method optimizes some objective function, $f(x)$ as a function of univariate or multivariate $x$, where $f(x)$ is univariate.</span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true" tabindex="-1"></a>The multivariate method extends the univariate, using the gradient (first derivative) vector and Hessian (second derivative) matrix.</span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true" tabindex="-1"></a>If we are at step $t-1$, the next value is:</span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true" tabindex="-1"></a>x_{t+1}=x_{t}-H_{f}(x_{t})^{-1}\nabla f(x_{t})</span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true" tabindex="-1"></a>where $\nabla f(x_{t})$ is the gradient (first derivative with respect to each element of $x$) and $H_{f}(x_{t})$ is the Hessian matrix (second derivatives with respect to all pairs of the elements of $x$).</span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true" tabindex="-1"></a>Here are the steps:</span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>determine a starting value, $x_0$.</span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>iterate:</span>
<span id="cb53-110"><a href="#cb53-110" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>at step $t$, the next value (the update) is given by the equation above</span>
<span id="cb53-111"><a href="#cb53-111" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>stop when $\left\Vert x_{t} - x_{t-1} \right\Vert$ is "small"</span>
<span id="cb53-112"><a href="#cb53-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-113"><a href="#cb53-113" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: Branching</span></span>
<span id="cb53-114"><a href="#cb53-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-115"><a href="#cb53-115" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Make sure you've committed your tests and any changes made to your univariate Newton's method to your <span class="in">`main`</span> branch. And make sure you push the changes to GitHub.</span>
<span id="cb53-116"><a href="#cb53-116" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Make a branch (called <span class="in">`multivariate`</span>) in which you'll implement the multivariate version of Newton's method (see details above)</span>
<span id="cb53-117"><a href="#cb53-117" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Implement the algorithm, either in <span class="in">`newton.py`</span> or in a new file if you prefer.</span>
<span id="cb53-118"><a href="#cb53-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-119"><a href="#cb53-119" aria-hidden="true" tabindex="-1"></a>You may need to search online for how to calculate $H_{f}(x_{t})^{-1}\nabla f(x_{t})$.</span>
<span id="cb53-120"><a href="#cb53-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-121"><a href="#cb53-121" aria-hidden="true" tabindex="-1"></a>At this point, if we think about calculating the Hessian it starts to feel more tedious to deal with the finite difference calculations, though it is a straightforward extension of what you already implemented. Feel free to look online to find a Python package that implements finite difference estimation of derivatives and use that in your code (see what Google indicates or if you use a ChatBot/LLM what they suggest).</span>
<span id="cb53-122"><a href="#cb53-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-123"><a href="#cb53-123" aria-hidden="true" tabindex="-1"></a>As you are writing the code, you can continue to think about what might go wrong and include defensive programming tactics. </span>
<span id="cb53-124"><a href="#cb53-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-125"><a href="#cb53-125" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: Pull requests (PRs)</span></span>
<span id="cb53-126"><a href="#cb53-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-127"><a href="#cb53-127" aria-hidden="true" tabindex="-1"></a>When you have your branch ready, make a pull request:</span>
<span id="cb53-128"><a href="#cb53-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-129"><a href="#cb53-129" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Make a pull request into the remote for the repository by pushing the branch to GitHub</span>
<span id="cb53-130"><a href="#cb53-130" aria-hidden="true" tabindex="-1"></a>   <span class="in">```bash</span></span>
<span id="cb53-131"><a href="#cb53-131" aria-hidden="true" tabindex="-1"></a>   <span class="fu">git</span> push <span class="at">-u</span> origin multivariate</span>
<span id="cb53-132"><a href="#cb53-132" aria-hidden="true" tabindex="-1"></a>   <span class="in">```</span></span>
<span id="cb53-133"><a href="#cb53-133" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb53-134"><a href="#cb53-134" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Go to GitHub to the <span class="in">`Pull requests`</span> tab and make the PR, making a note of what the PR is about.</span>
<span id="cb53-135"><a href="#cb53-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-136"><a href="#cb53-136" aria-hidden="true" tabindex="-1"></a>Don't (yet) merge in the PR. We want someone else to review it to have additional eyes on the code.</span>
<span id="cb53-137"><a href="#cb53-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-138"><a href="#cb53-138" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: Code review</span></span>
<span id="cb53-139"><a href="#cb53-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-140"><a href="#cb53-140" aria-hidden="true" tabindex="-1"></a>Now find a partner. </span>
<span id="cb53-141"><a href="#cb53-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-142"><a href="#cb53-142" aria-hidden="true" tabindex="-1"></a>Give the partner the URL for your repository on GitHub and ask them to look at the PR.</span>
<span id="cb53-143"><a href="#cb53-143" aria-hidden="true" tabindex="-1"></a>In turn get the URL for their repository.</span>
<span id="cb53-144"><a href="#cb53-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-145"><a href="#cb53-145" aria-hidden="true" tabindex="-1"></a>In reviewing the PR, make comments in the PR comment/conversation area on GitHub.</span>
<span id="cb53-146"><a href="#cb53-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-147"><a href="#cb53-147" aria-hidden="true" tabindex="-1"></a>If you have time, explore these two additional options for making comments:</span>
<span id="cb53-148"><a href="#cb53-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-149"><a href="#cb53-149" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Review changes:</span>
<span id="cb53-150"><a href="#cb53-150" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Click on the <span class="in">`Files changed`</span> tab (or go to <span class="in">`https://github.com/&lt;USERNAME&gt;/newton-practice/pull/&lt;PULL_ID&gt;/files`</span> for the specific "PULL_ID").</span>
<span id="cb53-151"><a href="#cb53-151" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Click on the <span class="in">`Review changes`</span> button.</span>
<span id="cb53-152"><a href="#cb53-152" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Make comments on specific lines</span>
<span id="cb53-153"><a href="#cb53-153" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Click on the <span class="in">`Files changed`</span> tab (or go to <span class="in">`https://github.com/&lt;USERNAME&gt;/newton-practice/pull/&lt;PULL_ID&gt;/files`</span> for the specific "PULL_ID").</span>
<span id="cb53-154"><a href="#cb53-154" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Hover over a specific line in a specific file with your mouse. A blue "plus" box should appear. Click on the plus to add a comment.</span>
<span id="cb53-155"><a href="#cb53-155" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Click on <span class="in">`Add single comment`</span> or optionally experiment with <span class="in">`Start a review`</span>.</span>
<span id="cb53-156"><a href="#cb53-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-157"><a href="#cb53-157" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip title="Code review guidelines"}</span>
<span id="cb53-158"><a href="#cb53-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-159"><a href="#cb53-159" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">This article</span><span class="co">](https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1012375)</span> gives tips on how to do good code review (and how to set up projects to facilitate good reviewing).</span>
<span id="cb53-160"><a href="#cb53-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-161"><a href="#cb53-161" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-162"><a href="#cb53-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-163"><a href="#cb53-163" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: Merge the PR</span></span>
<span id="cb53-164"><a href="#cb53-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-165"><a href="#cb53-165" aria-hidden="true" tabindex="-1"></a>Once you've seen the review by your partner:</span>
<span id="cb53-166"><a href="#cb53-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-167"><a href="#cb53-167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On DataHub, make changes to the branch that was used in the pull request. Then commit and push to GitHub.</span>
<span id="cb53-168"><a href="#cb53-168" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Alternatively, you could make the changes directly on GitHub using its editing capabilities.</span>
<span id="cb53-169"><a href="#cb53-169" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On GitHub, merge in the (now revised) pull request and close the request.</span>
<span id="cb53-170"><a href="#cb53-170" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>You may want to delete the branch. This helps avoid having a profusion of unneeded branches.</span>
<span id="cb53-171"><a href="#cb53-171" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>On DataHub, run <span class="in">`git pull`</span> to get the changes updated in the <span class="in">`main`</span> branch of your local repository.</span>
<span id="cb53-172"><a href="#cb53-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-173"><a href="#cb53-173" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb53-174"><a href="#cb53-174" aria-hidden="true" tabindex="-1"></a><span class="fu">## The full cycle of "git virtue"</span></span>
<span id="cb53-175"><a href="#cb53-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-176"><a href="#cb53-176" aria-hidden="true" tabindex="-1"></a>Congratulations. In the course of yesterday and  this morning, you've worked through the steps of a complete, albeit small, project using an extensive set of concepts, skills, and tools used in real world projects.</span>
<span id="cb53-177"><a href="#cb53-177" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-178"><a href="#cb53-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-179"><a href="#cb53-179" aria-hidden="true" tabindex="-1"></a><span class="fu"># 8. Numerical analysis and random number generation</span></span>
<span id="cb53-180"><a href="#cb53-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-181"><a href="#cb53-181" aria-hidden="true" tabindex="-1"></a><span class="fu">## Random number generation</span></span>
<span id="cb53-182"><a href="#cb53-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-183"><a href="#cb53-183" aria-hidden="true" tabindex="-1"></a>Random numbers on a computer are actually (periodic) deterministic sequences that (hopefully) behave as if they were random.</span>
<span id="cb53-184"><a href="#cb53-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-185"><a href="#cb53-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random number seed</span></span>
<span id="cb53-186"><a href="#cb53-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-187"><a href="#cb53-187" aria-hidden="true" tabindex="-1"></a>The *seed* determines where in the cycle of the periodic sequence you are.</span>
<span id="cb53-188"><a href="#cb53-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-189"><a href="#cb53-189" aria-hidden="true" tabindex="-1"></a>It's critical for ensuring reproducibility when running code that uses random numbers</span>
<span id="cb53-190"><a href="#cb53-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-193"><a href="#cb53-193" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-194"><a href="#cb53-194" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb53-195"><a href="#cb53-195" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb53-196"><a href="#cb53-196" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-197"><a href="#cb53-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-200"><a href="#cb53-200" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-201"><a href="#cb53-201" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-202"><a href="#cb53-202" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-205"><a href="#cb53-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-206"><a href="#cb53-206" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb53-207"><a href="#cb53-207" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb53-208"><a href="#cb53-208" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-209"><a href="#cb53-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-210"><a href="#cb53-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-211"><a href="#cb53-211" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random number generators</span></span>
<span id="cb53-212"><a href="#cb53-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-213"><a href="#cb53-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-214"><a href="#cb53-214" aria-hidden="true" tabindex="-1"></a>If you don't do anything, numpy will use a generator called the Mersenne Twister (that's the default in R too).</span>
<span id="cb53-215"><a href="#cb53-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-216"><a href="#cb53-216" aria-hidden="true" tabindex="-1"></a>However the "default" RNG in numpy is a newer, better algorithm called PCG64. </span>
<span id="cb53-217"><a href="#cb53-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-220"><a href="#cb53-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-221"><a href="#cb53-221" aria-hidden="true" tabindex="-1"></a><span class="co">## Mersenne twister</span></span>
<span id="cb53-222"><a href="#cb53-222" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">1</span>)</span>
<span id="cb53-223"><a href="#cb53-223" aria-hidden="true" tabindex="-1"></a>np.random.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-224"><a href="#cb53-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-227"><a href="#cb53-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-228"><a href="#cb53-228" aria-hidden="true" tabindex="-1"></a><span class="co">## Mersenne twister, selected specifically</span></span>
<span id="cb53-229"><a href="#cb53-229" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.Generator(np.random.MT19937(seed <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb53-230"><a href="#cb53-230" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-231"><a href="#cb53-231" aria-hidden="true" tabindex="-1"></a><span class="co">## Not clear why numbers differ from above. Seed setup might differ.</span></span>
<span id="cb53-232"><a href="#cb53-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-235"><a href="#cb53-235" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-236"><a href="#cb53-236" aria-hidden="true" tabindex="-1"></a><span class="co">## 'Default' PCG64</span></span>
<span id="cb53-237"><a href="#cb53-237" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.Generator(np.random.PCG64(seed <span class="op">=</span> <span class="dv">1</span>))</span>
<span id="cb53-238"><a href="#cb53-238" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-239"><a href="#cb53-239" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-242"><a href="#cb53-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-243"><a href="#cb53-243" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> np.random.default_rng(seed <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb53-244"><a href="#cb53-244" aria-hidden="true" tabindex="-1"></a>rng.normal(size <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb53-245"><a href="#cb53-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-246"><a href="#cb53-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-247"><a href="#cb53-247" aria-hidden="true" tabindex="-1"></a>Some cautions (<span class="co">[</span><span class="ot">detailed by Philip Stark and Kellie Ottoboni</span><span class="co">](https://arxiv.org/pdf/1810.10985)</span>):</span>
<span id="cb53-248"><a href="#cb53-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-249"><a href="#cb53-249" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>seeds with many zeros can be problematic.</span>
<span id="cb53-250"><a href="#cb53-250" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Mersenne Twister not as good as PCG64.</span>
<span id="cb53-251"><a href="#cb53-251" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be particularly cautious to use a good RNG when doing permutation and taking random samples.</span>
<span id="cb53-252"><a href="#cb53-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-253"><a href="#cb53-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-254"><a href="#cb53-254" aria-hidden="true" tabindex="-1"></a><span class="fu">## Floating point precision</span></span>
<span id="cb53-255"><a href="#cb53-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-258"><a href="#cb53-258" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-259"><a href="#cb53-259" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3</span> <span class="op">-</span> <span class="fl">0.2</span> <span class="op">==</span> <span class="fl">0.1</span></span>
<span id="cb53-260"><a href="#cb53-260" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3</span></span>
<span id="cb53-261"><a href="#cb53-261" aria-hidden="true" tabindex="-1"></a><span class="fl">0.2</span></span>
<span id="cb53-262"><a href="#cb53-262" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1</span> <span class="co"># Hmmm...</span></span>
<span id="cb53-263"><a href="#cb53-263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-264"><a href="#cb53-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-265"><a href="#cb53-265" aria-hidden="true" tabindex="-1"></a><span class="fu">### Double-precision accuracy</span></span>
<span id="cb53-266"><a href="#cb53-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-267"><a href="#cb53-267" aria-hidden="true" tabindex="-1"></a>Numbers in most languages are stored by default as double precision floating point numbers.</span>
<span id="cb53-268"><a href="#cb53-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-269"><a href="#cb53-269" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>8 bytes = 64 bits = double precision</span>
<span id="cb53-270"><a href="#cb53-270" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>4 bytes = 32 bits = single precision</span>
<span id="cb53-271"><a href="#cb53-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-272"><a href="#cb53-272" aria-hidden="true" tabindex="-1"></a>(GPU libraries often use 4 bytes or even fewer, or a mix of precisions.)</span>
<span id="cb53-273"><a href="#cb53-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-274"><a href="#cb53-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-277"><a href="#cb53-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-278"><a href="#cb53-278" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dg(x, form <span class="op">=</span> <span class="st">'.20f'</span>):</span>
<span id="cb53-279"><a href="#cb53-279" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">format</span>(x, form))</span>
<span id="cb53-280"><a href="#cb53-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-281"><a href="#cb53-281" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> <span class="fl">0.3</span></span>
<span id="cb53-282"><a href="#cb53-282" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb53-283"><a href="#cb53-283" aria-hidden="true" tabindex="-1"></a>dg(a)</span>
<span id="cb53-284"><a href="#cb53-284" aria-hidden="true" tabindex="-1"></a>dg(b)</span>
<span id="cb53-285"><a href="#cb53-285" aria-hidden="true" tabindex="-1"></a>dg(a<span class="op">-</span>b)</span>
<span id="cb53-286"><a href="#cb53-286" aria-hidden="true" tabindex="-1"></a>dg(<span class="fl">0.1</span>)</span>
<span id="cb53-287"><a href="#cb53-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-288"><a href="#cb53-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-289"><a href="#cb53-289" aria-hidden="true" tabindex="-1"></a>How many digits of accuracy do we have?</span>
<span id="cb53-290"><a href="#cb53-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-291"><a href="#cb53-291" aria-hidden="true" tabindex="-1"></a>Same thing regardless of the size of the number:</span>
<span id="cb53-292"><a href="#cb53-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-295"><a href="#cb53-295" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-296"><a href="#cb53-296" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678.1234567812345678</span></span>
<span id="cb53-297"><a href="#cb53-297" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-300"><a href="#cb53-300" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-301"><a href="#cb53-301" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678123456781234.5678</span></span>
<span id="cb53-302"><a href="#cb53-302" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-305"><a href="#cb53-305" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-306"><a href="#cb53-306" aria-hidden="true" tabindex="-1"></a>dg(<span class="fl">12345678123456781234.5678</span>)</span>
<span id="cb53-307"><a href="#cb53-307" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-308"><a href="#cb53-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-309"><a href="#cb53-309" aria-hidden="true" tabindex="-1"></a>This occurs because of how the 64 bits in a double precision floating point number are allocated to give a large range of numbers in terms of magnitude and high precision in terms of digits of accuracy.</span>
<span id="cb53-310"><a href="#cb53-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-311"><a href="#cb53-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-312"><a href="#cb53-312" aria-hidden="true" tabindex="-1"></a><span class="fu">### Comparisons</span></span>
<span id="cb53-313"><a href="#cb53-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-314"><a href="#cb53-314" aria-hidden="true" tabindex="-1"></a>Let's see what kinds of numbers we can safely compare for exact equality with <span class="in">`==`</span>.</span>
<span id="cb53-315"><a href="#cb53-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-318"><a href="#cb53-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-319"><a href="#cb53-319" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb53-320"><a href="#cb53-320" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span></span>
<span id="cb53-321"><a href="#cb53-321" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb53-322"><a href="#cb53-322" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">1.5</span> <span class="op">-</span> <span class="fl">.2</span></span>
<span id="cb53-323"><a href="#cb53-323" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="fl">0.3</span></span>
<span id="cb53-324"><a href="#cb53-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-325"><a href="#cb53-325" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.5</span></span>
<span id="cb53-326"><a href="#cb53-326" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb53-327"><a href="#cb53-327" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span>  <span class="op">-</span><span class="fl">.3</span></span>
<span id="cb53-328"><a href="#cb53-328" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb53-329"><a href="#cb53-329" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> (<span class="fl">.5</span> <span class="op">-</span> <span class="fl">.2</span>) <span class="op">-</span> (<span class="fl">.51</span> <span class="op">-</span> <span class="fl">.21</span>)</span>
<span id="cb53-330"><a href="#cb53-330" aria-hidden="true" tabindex="-1"></a>x <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb53-331"><a href="#cb53-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-332"><a href="#cb53-332" aria-hidden="true" tabindex="-1"></a>np.isclose(x, <span class="dv">0</span>)</span>
<span id="cb53-333"><a href="#cb53-333" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-334"><a href="#cb53-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-335"><a href="#cb53-335" aria-hidden="true" tabindex="-1"></a><span class="fu">### Calculation errors</span></span>
<span id="cb53-336"><a href="#cb53-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-337"><a href="#cb53-337" aria-hidden="true" tabindex="-1"></a>Let's consider accuracy of subtraction.</span>
<span id="cb53-338"><a href="#cb53-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-341"><a href="#cb53-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-342"><a href="#cb53-342" aria-hidden="true" tabindex="-1"></a><span class="fl">1.1234</span> <span class="op">-</span> <span class="fl">1.0</span></span>
<span id="cb53-343"><a href="#cb53-343" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-346"><a href="#cb53-346" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-347"><a href="#cb53-347" aria-hidden="true" tabindex="-1"></a><span class="fl">123456781234.1234</span> <span class="op">-</span> <span class="fl">123456781234.0</span></span>
<span id="cb53-348"><a href="#cb53-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-349"><a href="#cb53-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-350"><a href="#cb53-350" aria-hidden="true" tabindex="-1"></a>This is called catastrophic cancellation.</span>
<span id="cb53-351"><a href="#cb53-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-352"><a href="#cb53-352" aria-hidden="true" tabindex="-1"></a>Do you think calling it "catastrophic" is too extreme? If so, consider this.</span>
<span id="cb53-353"><a href="#cb53-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-356"><a href="#cb53-356" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-357"><a href="#cb53-357" aria-hidden="true" tabindex="-1"></a><span class="fl">81.0</span> <span class="op">-</span> <span class="fl">80.0</span></span>
<span id="cb53-358"><a href="#cb53-358" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-361"><a href="#cb53-361" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-362"><a href="#cb53-362" aria-hidden="true" tabindex="-1"></a><span class="fl">12345678123456781.0</span> <span class="op">-</span><span class="fl">12345678123456780.0</span></span>
<span id="cb53-363"><a href="#cb53-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-364"><a href="#cb53-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-365"><a href="#cb53-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-366"><a href="#cb53-366" aria-hidden="true" tabindex="-1"></a>What's the derivative of $sin(x)$? Let's see what kind of accuracy we can get.</span>
<span id="cb53-367"><a href="#cb53-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-370"><a href="#cb53-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-371"><a href="#cb53-371" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb53-372"><a href="#cb53-372" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> deriv(f, x, eps<span class="op">=</span><span class="fl">1e-8</span>):</span>
<span id="cb53-373"><a href="#cb53-373" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> (f(x<span class="op">+</span>eps) <span class="op">-</span> f(x)) <span class="op">/</span> eps</span>
<span id="cb53-374"><a href="#cb53-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-375"><a href="#cb53-375" aria-hidden="true" tabindex="-1"></a>np.cos(<span class="fl">0.2</span>)</span>
<span id="cb53-376"><a href="#cb53-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-377"><a href="#cb53-377" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>)</span>
<span id="cb53-378"><a href="#cb53-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-379"><a href="#cb53-379" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-12</span>)</span>
<span id="cb53-380"><a href="#cb53-380" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-14</span>)</span>
<span id="cb53-381"><a href="#cb53-381" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-15</span>)</span>
<span id="cb53-382"><a href="#cb53-382" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-16</span>)</span>
<span id="cb53-383"><a href="#cb53-383" aria-hidden="true" tabindex="-1"></a>deriv(np.sin, <span class="fl">0.2</span>, <span class="fl">1e-17</span>)</span>
<span id="cb53-384"><a href="#cb53-384" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-385"><a href="#cb53-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-386"><a href="#cb53-386" aria-hidden="true" tabindex="-1"></a><span class="fu">### Linear algebra errors</span></span>
<span id="cb53-387"><a href="#cb53-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-388"><a href="#cb53-388" aria-hidden="true" tabindex="-1"></a>The errors seen in doing calculations, such as catastrophic cancellation, cascaded through derivative estimation. That also happens when doing linear algebra operations.</span>
<span id="cb53-389"><a href="#cb53-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-390"><a href="#cb53-390" aria-hidden="true" tabindex="-1"></a>Here's an example where mathematically all the eigenvalues are real-valued and positive, but not on the computer.</span>
<span id="cb53-391"><a href="#cb53-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-394"><a href="#cb53-394" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-395"><a href="#cb53-395" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb53-396"><a href="#cb53-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-397"><a href="#cb53-397" aria-hidden="true" tabindex="-1"></a>xs <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb53-398"><a href="#cb53-398" aria-hidden="true" tabindex="-1"></a>dists <span class="op">=</span> np.<span class="bu">abs</span>(xs[:, np.newaxis] <span class="op">-</span> xs)</span>
<span id="cb53-399"><a href="#cb53-399" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a p.d. matrix (mathematically).</span></span>
<span id="cb53-400"><a href="#cb53-400" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> np.exp(<span class="op">-</span>(dists<span class="op">/</span><span class="dv">10</span>)<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb53-401"><a href="#cb53-401" aria-hidden="true" tabindex="-1"></a><span class="co"># But not numerically...</span></span>
<span id="cb53-402"><a href="#cb53-402" aria-hidden="true" tabindex="-1"></a>sp.linalg.eigvals(corr_matrix)[<span class="dv">80</span>:<span class="dv">99</span>]</span>
<span id="cb53-403"><a href="#cb53-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-404"><a href="#cb53-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-405"><a href="#cb53-405" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-406"><a href="#cb53-406" aria-hidden="true" tabindex="-1"></a><span class="fu">### Overflow and underflow</span></span>
<span id="cb53-407"><a href="#cb53-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-408"><a href="#cb53-408" aria-hidden="true" tabindex="-1"></a>Having a finite number of bits to represent each number means there are minimum and maximum numbers that can be expressed.</span>
<span id="cb53-409"><a href="#cb53-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-412"><a href="#cb53-412" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-413"><a href="#cb53-413" aria-hidden="true" tabindex="-1"></a><span class="fl">1.38e5000</span></span>
<span id="cb53-414"><a href="#cb53-414" aria-hidden="true" tabindex="-1"></a><span class="fl">1.38e-400</span></span>
<span id="cb53-415"><a href="#cb53-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-416"><a href="#cb53-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-417"><a href="#cb53-417" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb53-418"><a href="#cb53-418" aria-hidden="true" tabindex="-1"></a><span class="fu">## How much do we need to worry about overflow and underflow?</span></span>
<span id="cb53-419"><a href="#cb53-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-420"><a href="#cb53-420" aria-hidden="true" tabindex="-1"></a>Q: Roughly how many observations would it take before we underflow in calculating a likelihood?</span>
<span id="cb53-421"><a href="#cb53-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-422"><a href="#cb53-422" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>10</span>
<span id="cb53-423"><a href="#cb53-423" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>100</span>
<span id="cb53-424"><a href="#cb53-424" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>1000</span>
<span id="cb53-425"><a href="#cb53-425" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>100000</span>
<span id="cb53-426"><a href="#cb53-426" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>100000000</span>
<span id="cb53-427"><a href="#cb53-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-428"><a href="#cb53-428" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-429"><a href="#cb53-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-432"><a href="#cb53-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-433"><a href="#cb53-433" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb53-434"><a href="#cb53-434" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> scipy <span class="im">as</span> sp</span>
<span id="cb53-435"><a href="#cb53-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-436"><a href="#cb53-436" aria-hidden="true" tabindex="-1"></a>n <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb53-437"><a href="#cb53-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-438"><a href="#cb53-438" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.random.normal(size<span class="op">=</span>n)</span>
<span id="cb53-439"><a href="#cb53-439" aria-hidden="true" tabindex="-1"></a>np.prod(sp.stats.norm.pdf(x))</span>
<span id="cb53-440"><a href="#cb53-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-441"><a href="#cb53-441" aria-hidden="true" tabindex="-1"></a>loglik <span class="op">=</span> np.<span class="bu">sum</span>(sp.stats.norm.logpdf(x))</span>
<span id="cb53-442"><a href="#cb53-442" aria-hidden="true" tabindex="-1"></a>loglik</span>
<span id="cb53-443"><a href="#cb53-443" aria-hidden="true" tabindex="-1"></a>np.exp(loglik)</span>
<span id="cb53-444"><a href="#cb53-444" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-445"><a href="#cb53-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-446"><a href="#cb53-446" aria-hidden="true" tabindex="-1"></a>::: {.callout-important}</span>
<span id="cb53-447"><a href="#cb53-447" aria-hidden="true" tabindex="-1"></a><span class="fu">## Work with probabilities and densities on the log scale. Almost always.</span></span>
<span id="cb53-448"><a href="#cb53-448" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-449"><a href="#cb53-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-450"><a href="#cb53-450" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: forking and pull requests for numerical issues with Newton's method</span></span>
<span id="cb53-451"><a href="#cb53-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-452"><a href="#cb53-452" aria-hidden="true" tabindex="-1"></a>Look at your partner's code in terms of how it handles the stopping criterion or (for the 1-d case) the finite difference estimate of the gradient and Hessian.</span>
<span id="cb53-453"><a href="#cb53-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-454"><a href="#cb53-454" aria-hidden="true" tabindex="-1"></a>Fork your partner's repository. In the local version of that repository on your DataHub, make a change to try to improve how the stopping criterion or finite difference estimate is handled. Then make a pull request back into your partner's repository.</span>
<span id="cb53-455"><a href="#cb53-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-456"><a href="#cb53-456" aria-hidden="true" tabindex="-1"></a>Here are the detailed steps of how to do all that:</span>
<span id="cb53-457"><a href="#cb53-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-458"><a href="#cb53-458" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Go to your partner's GitHub page and fork the repository (<span class="in">`https://github.com/&lt;username&gt;/newton-practice/fork`</span>). You can name it <span class="in">`newton-practice-&lt;partner_name&gt;`</span> or something else. </span>
<span id="cb53-459"><a href="#cb53-459" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>On DataHub, clone the forked repository: <span class="in">`git clone https://github.com/&lt;your_username&gt;/newton-practice-&lt;partner_name&gt;`</span>.</span>
<span id="cb53-460"><a href="#cb53-460" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>On DataHub, enter the directory of the cloned repository: <span class="in">`cd newton-practice-&lt;partner_name&gt;`</span>.</span>
<span id="cb53-461"><a href="#cb53-461" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>Make a branch, make changes, add, and commit.</span>
<span id="cb53-462"><a href="#cb53-462" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Give DataHub access to the new repository via <span class="co">[</span><span class="ot">Step 3 of the steps for accessing GitHub repository from DataHub</span><span class="co">](https://berkeley-scf.github.io/compute-skills-2025/prep.html#give-access-to-the-specific-github-repository-you-are-working-with)</span>.</span>
<span id="cb53-463"><a href="#cb53-463" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span>Push the commit to your GitHub: <span class="in">`git push -u origin newton-practice-&lt;partner_name&gt;`</span>.</span>
<span id="cb53-464"><a href="#cb53-464" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span>Go to <span class="in">`https://github.com/&lt;your_username&gt;/newton-practice-&lt;partner_name&gt;`</span> and open a pull request ("Compare and pull request") with the new branch. The request will automatically be done in the GitHub account of your partner.</span>
<span id="cb53-465"><a href="#cb53-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-466"><a href="#cb53-466" aria-hidden="true" tabindex="-1"></a>Then review the pull request your partner makes in your own repository. Iterate with your partner until you are happy to merge the pull request into your repository. Remember to then run <span class="in">`git pull`</span> to get the changes in the local copy of the repository.</span>
<span id="cb53-467"><a href="#cb53-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-468"><a href="#cb53-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-469"><a href="#cb53-469" aria-hidden="true" tabindex="-1"></a><span class="fu"># 9. Packaging and Conda environments</span></span>
<span id="cb53-470"><a href="#cb53-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-471"><a href="#cb53-471" aria-hidden="true" tabindex="-1"></a><span class="fu">## Packages</span></span>
<span id="cb53-472"><a href="#cb53-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-473"><a href="#cb53-473" aria-hidden="true" tabindex="-1"></a>What's a package? In general it is software that is provided as a bundle that can be downloaded and made available on your computer.</span>
<span id="cb53-474"><a href="#cb53-474" aria-hidden="true" tabindex="-1"></a>Some packages (e.g., R, Python themselves) are stand-alone packages. Others (such as R packages and Python packages) are add-on functionality that works with and extends the functionality of the stand-alone software.</span>
<span id="cb53-475"><a href="#cb53-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-476"><a href="#cb53-476" aria-hidden="true" tabindex="-1"></a>What do we need to have a Python package?</span>
<span id="cb53-477"><a href="#cb53-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-478"><a href="#cb53-478" aria-hidden="true" tabindex="-1"></a><span class="fu">### A basic Python package</span></span>
<span id="cb53-479"><a href="#cb53-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-480"><a href="#cb53-480" aria-hidden="true" tabindex="-1"></a>A Python package is a directory containing one or more modules and with a file</span>
<span id="cb53-481"><a href="#cb53-481" aria-hidden="true" tabindex="-1"></a>named <span class="in">`__init__.py`</span> that is called when a package is imported and</span>
<span id="cb53-482"><a href="#cb53-482" aria-hidden="true" tabindex="-1"></a>serves to initialize the package.</span>
<span id="cb53-483"><a href="#cb53-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-484"><a href="#cb53-484" aria-hidden="true" tabindex="-1"></a>Let's create a basic package.</span>
<span id="cb53-485"><a href="#cb53-485" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-486"><a href="#cb53-486" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-487"><a href="#cb53-487" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> mypkg</span>
<span id="cb53-488"><a href="#cb53-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-489"><a href="#cb53-489" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> mypkg/__init__.py</span>
<span id="cb53-490"><a href="#cb53-490" aria-hidden="true" tabindex="-1"></a><span class="st">## Make objects from mymod.py available as </span><span class="kw">`</span><span class="ex">mypkg.object_name</span><span class="kw">`</span>.</span>
<span id="cb53-491"><a href="#cb53-491" aria-hidden="true" tabindex="-1"></a><span class="st">from mypkg.mymod import *</span></span>
<span id="cb53-492"><a href="#cb53-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-493"><a href="#cb53-493" aria-hidden="true" tabindex="-1"></a><span class="st">print("Welcome to my package.")</span></span>
<span id="cb53-494"><a href="#cb53-494" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb53-495"><a href="#cb53-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-496"><a href="#cb53-496" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&lt;&lt; EOF</span> <span class="op">&gt;</span> mypkg/mymod.py</span>
<span id="cb53-497"><a href="#cb53-497" aria-hidden="true" tabindex="-1"></a><span class="st">x = 7</span></span>
<span id="cb53-498"><a href="#cb53-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-499"><a href="#cb53-499" aria-hidden="true" tabindex="-1"></a><span class="st">def myfun(val):</span></span>
<span id="cb53-500"><a href="#cb53-500" aria-hidden="true" tabindex="-1"></a><span class="st">    print("The arg is: ", str(val), ".", sep = '')</span></span>
<span id="cb53-501"><a href="#cb53-501" aria-hidden="true" tabindex="-1"></a><span class="op">EOF</span></span>
<span id="cb53-502"><a href="#cb53-502" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-503"><a href="#cb53-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-504"><a href="#cb53-504" aria-hidden="true" tabindex="-1"></a>Note that if there were other modules (i.e., Python code files), we could have imported from those as well.</span>
<span id="cb53-505"><a href="#cb53-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-506"><a href="#cb53-506" aria-hidden="true" tabindex="-1"></a>Now we can use the objects from the package without having to know</span>
<span id="cb53-507"><a href="#cb53-507" aria-hidden="true" tabindex="-1"></a>that it was in a particular module (because of how <span class="in">`__init__.py`</span> was set up).</span>
<span id="cb53-508"><a href="#cb53-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-511"><a href="#cb53-511" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-512"><a href="#cb53-512" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb53-513"><a href="#cb53-513" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mypkg</span>
<span id="cb53-514"><a href="#cb53-514" aria-hidden="true" tabindex="-1"></a>mypkg.x</span>
<span id="cb53-515"><a href="#cb53-515" aria-hidden="true" tabindex="-1"></a>mypkg.myfun(<span class="dv">7</span>)</span>
<span id="cb53-516"><a href="#cb53-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-517"><a href="#cb53-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-518"><a href="#cb53-518" aria-hidden="true" tabindex="-1"></a>Note that one can set <span class="in">`__all__`</span> in an <span class="in">`__init__.py`</span> to define what is imported,</span>
<span id="cb53-519"><a href="#cb53-519" aria-hidden="true" tabindex="-1"></a>which makes clear what is publicly available and hides what is considered</span>
<span id="cb53-520"><a href="#cb53-520" aria-hidden="true" tabindex="-1"></a>internal.</span>
<span id="cb53-521"><a href="#cb53-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-522"><a href="#cb53-522" aria-hidden="true" tabindex="-1"></a><span class="fu">### A minimal "real" package</span></span>
<span id="cb53-523"><a href="#cb53-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-524"><a href="#cb53-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-525"><a href="#cb53-525" aria-hidden="true" tabindex="-1"></a>Fernando has a <span class="co">[</span><span class="ot">this toy example package</span><span class="co">](https://github.com/fperez/mytoy)</span>.</span>
<span id="cb53-526"><a href="#cb53-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-527"><a href="#cb53-527" aria-hidden="true" tabindex="-1"></a>Let's clone the repository and see if we can install it.</span>
<span id="cb53-528"><a href="#cb53-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-529"><a href="#cb53-529" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-530"><a href="#cb53-530" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone https://github.com/fperez/mytoy</span>
<span id="cb53-531"><a href="#cb53-531" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> mytoy</span>
<span id="cb53-532"><a href="#cb53-532" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">--user</span> .</span>
<span id="cb53-533"><a href="#cb53-533" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span>
<span id="cb53-534"><a href="#cb53-534" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> .local/lib/python3.11/site-packages</span>
<span id="cb53-535"><a href="#cb53-535" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-536"><a href="#cb53-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-539"><a href="#cb53-539" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-540"><a href="#cb53-540" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb53-541"><a href="#cb53-541" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> mytoy</span>
<span id="cb53-542"><a href="#cb53-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-543"><a href="#cb53-543" aria-hidden="true" tabindex="-1"></a>mytoy.toy(<span class="dv">7</span>)</span>
<span id="cb53-544"><a href="#cb53-544" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-545"><a href="#cb53-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-546"><a href="#cb53-546" aria-hidden="true" tabindex="-1"></a>Let's look in the top directory of the repository. There we see various files related to building and installing the package, namely, <span class="in">`pyproj.toml`</span>, <span class="in">`setup.py`</span>, <span class="in">`setup.cfg`</span>, etc.</span>
<span id="cb53-547"><a href="#cb53-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-548"><a href="#cb53-548" aria-hidden="true" tabindex="-1"></a>In fact, one can install the package with only</span>
<span id="cb53-549"><a href="#cb53-549" aria-hidden="true" tabindex="-1"></a>either <span class="in">`setup.py`</span> or <span class="in">`pyproj.toml`</span>, but the other files listed here are recommended:</span>
<span id="cb53-550"><a href="#cb53-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-551"><a href="#cb53-551" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pyproj.toml`</span> (or <span class="in">`pyproject.toml`</span>): this is a configuration file used by packaging tools. In the <span class="in">`mytoy`</span> example it specifies to use <span class="in">`setuptools`</span> to build and install the package.</span>
<span id="cb53-552"><a href="#cb53-552" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`setup.py`</span>: this is run when the package is built and installed when using <span class="in">`setuptools`</span>. In the example, it simply runs <span class="in">`setuptools.setup()`</span>. With recent versions of</span>
<span id="cb53-553"><a href="#cb53-553" aria-hidden="true" tabindex="-1"></a><span class="in">`setuptools`</span>, you don't actually need this so long as you have the <span class="in">`pyproj.toml`</span> file.</span>
<span id="cb53-554"><a href="#cb53-554" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`setup.cfg`</span>: provides metadata about the package when using <span class="in">`setuptools`</span>.</span>
<span id="cb53-555"><a href="#cb53-555" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`environment.yml`</span>: provides information about the full environment in which your package should be used (including examples, documentation, etc.). For projects using <span class="in">`setuptools`</span>, a minimal list of dependencies needed for installation and use of the package can instead be included in the <span class="in">`install_requires`</span> option of <span class="in">`setup.cfg`</span>.</span>
<span id="cb53-556"><a href="#cb53-556" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`LICENSE`</span>: specifies the license for your package giving the terms under which others can use it.</span>
<span id="cb53-557"><a href="#cb53-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-558"><a href="#cb53-558" aria-hidden="true" tabindex="-1"></a>The <span class="in">`postBuild`</span> file is  a completely optional file only needed if you want to use the package with a MyBinder environment.</span>
<span id="cb53-559"><a href="#cb53-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-560"><a href="#cb53-560" aria-hidden="true" tabindex="-1"></a>At the <span class="co">[</span><span class="ot">numpy GitHub repository</span><span class="co">](https://github.com/numpy/numpy)</span>, by looking in  <span class="in">`pyproject.toml`</span>, you can see that <span class="in">`numpy`</span> is build and installed using a system called *Meson*, while at the <span class="co">[</span><span class="ot">Jupyter GitHub repository</span><span class="co">](https://github.com/jupyter/jupyter)</span> you can see that the <span class="in">`jupyter`</span> package is built and installed using <span class="in">`setuptools`</span>.</span>
<span id="cb53-561"><a href="#cb53-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-562"><a href="#cb53-562" aria-hidden="true" tabindex="-1"></a>*Building* a package usually refers to compiling source code but for a Python package that just has Python code, nothing needs to be compiled. *Installing* a package means putting the built package into a location on your computer where packages are installed.</span>
<span id="cb53-563"><a href="#cb53-563" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-564"><a href="#cb53-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-565"><a href="#cb53-565" aria-hidden="true" tabindex="-1"></a>It would take more work to make the package available in a repository such as PyPI or via Conda.</span>
<span id="cb53-566"><a href="#cb53-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-567"><a href="#cb53-567" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercise: Make your own package</span></span>
<span id="cb53-568"><a href="#cb53-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-569"><a href="#cb53-569" aria-hidden="true" tabindex="-1"></a>Make a package out of your Newton method code, following the structure of <span class="in">`mytoy`</span>. Include your tests as part of the package.</span>
<span id="cb53-570"><a href="#cb53-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-571"><a href="#cb53-571" aria-hidden="true" tabindex="-1"></a>See if you can install your package, run the tests, and use the package, following the <span class="in">`README.md`</span> of <span class="in">`mytoy`</span>.</span>
<span id="cb53-572"><a href="#cb53-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-573"><a href="#cb53-573" aria-hidden="true" tabindex="-1"></a><span class="fu">## Installing packages</span></span>
<span id="cb53-574"><a href="#cb53-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-575"><a href="#cb53-575" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-576"><a href="#cb53-576" aria-hidden="true" tabindex="-1"></a>If a package is on PyPI or available through Conda but not on your system, you can install it</span>
<span id="cb53-577"><a href="#cb53-577" aria-hidden="true" tabindex="-1"></a>easily (usually). You don't need root permission on a machine to install</span>
<span id="cb53-578"><a href="#cb53-578" aria-hidden="true" tabindex="-1"></a>a package, though you may need to use <span class="in">`pip install --user`</span> or set up a new Conda environment.</span>
<span id="cb53-579"><a href="#cb53-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-580"><a href="#cb53-580" aria-hidden="true" tabindex="-1"></a>Packages often depend on other packages. In general, if one package depends on another,</span>
<span id="cb53-581"><a href="#cb53-581" aria-hidden="true" tabindex="-1"></a>pip or conda will generally install the dependency automatically.</span>
<span id="cb53-582"><a href="#cb53-582" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-583"><a href="#cb53-583" aria-hidden="true" tabindex="-1"></a>One advantage of Conda is that it can also install non-Python packages on which a Python</span>
<span id="cb53-584"><a href="#cb53-584" aria-hidden="true" tabindex="-1"></a>package depends, whereas with pip you sometimes need to install a system package to</span>
<span id="cb53-585"><a href="#cb53-585" aria-hidden="true" tabindex="-1"></a>satisfy a dependency.</span>
<span id="cb53-586"><a href="#cb53-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-587"><a href="#cb53-587" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb53-588"><a href="#cb53-588" aria-hidden="true" tabindex="-1"></a><span class="fu">## Faster installation with Mamba</span></span>
<span id="cb53-589"><a href="#cb53-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-590"><a href="#cb53-590" aria-hidden="true" tabindex="-1"></a>It's not uncommon to run into a case where conda has trouble installing a package</span>
<span id="cb53-591"><a href="#cb53-591" aria-hidden="true" tabindex="-1"></a>because of version inconsistencies amongst the dependencies. <span class="in">`mamba`</span> is a drop-in</span>
<span id="cb53-592"><a href="#cb53-592" aria-hidden="true" tabindex="-1"></a>replacement for <span class="in">`conda`</span> and often does a better job of this "dependency resolution".</span>
<span id="cb53-593"><a href="#cb53-593" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">We use `mamba` by default on the SCF</span><span class="co">](https://statistics.berkeley.edu/computing/software/install)</span>.</span>
<span id="cb53-594"><a href="#cb53-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-595"><a href="#cb53-595" aria-hidden="true" tabindex="-1"></a>With newer versions of Conda, you can use the <span class="in">`libmamba`</span> dependency "resolver" by running <span class="in">`conda config --set solver libmamba`</span>, which adds <span class="in">`solver: libmamba`</span> to your <span class="in">`.condarc`</span> file.</span>
<span id="cb53-596"><a href="#cb53-596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-597"><a href="#cb53-597" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-598"><a href="#cb53-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-599"><a href="#cb53-599" aria-hidden="true" tabindex="-1"></a><span class="fu">### Reproducibility and package management</span></span>
<span id="cb53-600"><a href="#cb53-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-601"><a href="#cb53-601" aria-hidden="true" tabindex="-1"></a>For reproducibility, it's important to know the versions of the packages you use (and the version of Python).</span>
<span id="cb53-602"><a href="#cb53-602" aria-hidden="true" tabindex="-1"></a><span class="in">`pip`</span> and <span class="in">`conda`</span> make it easy to do this. You can create a *requirements* file that captures the packages you are currently using (and, critically, their versions) and then install exactly that set of packages (and versions) based on that requirements file.</span>
<span id="cb53-603"><a href="#cb53-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-604"><a href="#cb53-604" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-605"><a href="#cb53-605" aria-hidden="true" tabindex="-1"></a><span class="co">## Reproducing using pip.</span></span>
<span id="cb53-606"><a href="#cb53-606" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> freeze <span class="op">&gt;</span> requirements.txt</span>
<span id="cb53-607"><a href="#cb53-607" aria-hidden="true" tabindex="-1"></a><span class="ex">pip</span> install <span class="at">-r</span> requirements.txt</span>
<span id="cb53-608"><a href="#cb53-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-609"><a href="#cb53-609" aria-hidden="true" tabindex="-1"></a><span class="co">## Reproducing a Conda environment.</span></span>
<span id="cb53-610"><a href="#cb53-610" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> environment.yml</span>
<span id="cb53-611"><a href="#cb53-611" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env create <span class="at">-f</span> environment.yml</span>
<span id="cb53-612"><a href="#cb53-612" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-613"><a href="#cb53-613" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-614"><a href="#cb53-614" aria-hidden="true" tabindex="-1"></a>Conda is a general package manager. You can use it to manage Python packages but lots of other software as well, including R and Julia.</span>
<span id="cb53-615"><a href="#cb53-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-616"><a href="#cb53-616" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Fully isolating your Conda environment</span></span>
<span id="cb53-617"><a href="#cb53-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-618"><a href="#cb53-618" aria-hidden="true" tabindex="-1"></a>Conda environments provide an additional layer of modularity/reproducibility, allowing you to set up a fully reproducible environment for your computation. Here (by explicitly giving <span class="in">`python=3.11`</span>) the Python 3.11 executable and all packages you install in the environment are fully independent  of whatever Python executables are installed on the system. (That said, there are <span class="co">[</span><span class="ot">some caveats</span><span class="co">](https://statistics.berkeley.edu/computing/software/install#conda-isolate)</span> that can make it a bit of headache to ensure full isolation.)</span>
<span id="cb53-619"><a href="#cb53-619" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-620"><a href="#cb53-620" aria-hidden="true" tabindex="-1"></a><span class="in">```bash</span></span>
<span id="cb53-621"><a href="#cb53-621" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> python</span>
<span id="cb53-622"><a href="#cb53-622" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-623"><a href="#cb53-623" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> create <span class="at">-n</span> my_iso_env python=3.11</span>
<span id="cb53-624"><a href="#cb53-624" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> activate my_iso_env</span>
<span id="cb53-625"><a href="#cb53-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-626"><a href="#cb53-626" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span> python</span>
<span id="cb53-627"><a href="#cb53-627" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> install numpy</span>
<span id="cb53-628"><a href="#cb53-628" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-629"><a href="#cb53-629" aria-hidden="true" tabindex="-1"></a><span class="co">## (Optionally) saving the recipe:</span></span>
<span id="cb53-630"><a href="#cb53-630" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> env export <span class="op">&gt;</span> my_iso_env.yml</span>
<span id="cb53-631"><a href="#cb53-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-632"><a href="#cb53-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-633"><a href="#cb53-633" aria-hidden="true" tabindex="-1"></a>::: {.callout-warning}</span>
<span id="cb53-634"><a href="#cb53-634" aria-hidden="true" tabindex="-1"></a><span class="fu">## Activating an environment</span></span>
<span id="cb53-635"><a href="#cb53-635" aria-hidden="true" tabindex="-1"></a>If you use <span class="in">`conda activate`</span> rather than <span class="in">`source activate`</span>, Conda will prompt you to run <span class="in">`conda init`</span>, which will make changes to your <span class="in">`~/.bashrc`</span> that, for one, activate the Conda base environment automatically when a shell is started. This may be fine, but it's helpful to be aware.</span>
<span id="cb53-636"><a href="#cb53-636" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-637"><a href="#cb53-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-638"><a href="#cb53-638" aria-hidden="true" tabindex="-1"></a><span class="fu">### Package locations</span></span>
<span id="cb53-639"><a href="#cb53-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-640"><a href="#cb53-640" aria-hidden="true" tabindex="-1"></a>Packages in Python (and in R, Julia, etc.) may be installed in various places</span>
<span id="cb53-641"><a href="#cb53-641" aria-hidden="true" tabindex="-1"></a>on the filesystem, and it sometimes it is helpful (e.g., if you end up with multiple</span>
<span id="cb53-642"><a href="#cb53-642" aria-hidden="true" tabindex="-1"></a>versions of a package installed on your system) to be able to figure out </span>
<span id="cb53-643"><a href="#cb53-643" aria-hidden="true" tabindex="-1"></a>where on the filesystem the package is being loaded from. </span>
<span id="cb53-644"><a href="#cb53-644" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-645"><a href="#cb53-645" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pkgname.__file__`</span> will show where the imported package is installed.</span>
<span id="cb53-646"><a href="#cb53-646" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`pkname.__version__`</span> will show the version of the package (as will <span class="in">`pip list`</span> or <span class="in">`conda list`</span>, for all packages).</span>
<span id="cb53-647"><a href="#cb53-647" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`sys.path`</span> shows where Python looks for packages on your system.</span>
<span id="cb53-648"><a href="#cb53-648" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>packages installed via <span class="in">`pip`</span> will generally be in <span class="in">`~/.local/lib/python3.X/site-packages`</span>.</span>
<span id="cb53-649"><a href="#cb53-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-650"><a href="#cb53-650" aria-hidden="true" tabindex="-1"></a>Let's check that <span class="in">`numpy`</span> got installed into the <span class="in">`my_iso_env`</span> environment where we expect it to be.</span>
<span id="cb53-651"><a href="#cb53-651" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-654"><a href="#cb53-654" aria-hidden="true" tabindex="-1"></a><span class="in">```{python}</span></span>
<span id="cb53-655"><a href="#cb53-655" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb53-656"><a href="#cb53-656" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb53-657"><a href="#cb53-657" aria-hidden="true" tabindex="-1"></a>numpy.<span class="va">__file__</span></span>
<span id="cb53-658"><a href="#cb53-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-659"><a href="#cb53-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-660"><a href="#cb53-660" aria-hidden="true" tabindex="-1"></a><span class="fu">### Source vs. binary packages</span></span>
<span id="cb53-661"><a href="#cb53-661" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-662"><a href="#cb53-662" aria-hidden="true" tabindex="-1"></a>The difference between a *source* package and a *binary* package is that</span>
<span id="cb53-663"><a href="#cb53-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-664"><a href="#cb53-664" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a *source* package has the raw Python (and C/C++ and Fortran, in some cases) code</span>
<span id="cb53-665"><a href="#cb53-665" aria-hidden="true" tabindex="-1"></a>as text files</span>
<span id="cb53-666"><a href="#cb53-666" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>a *binary* package has all the non-Python code in a binary/non-text format, with the  C/C++ and Fortran code already having been compiled.</span>
<span id="cb53-667"><a href="#cb53-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-668"><a href="#cb53-668" aria-hidden="true" tabindex="-1"></a>If you install a package from source, C/C++/Fortran code will be compiled on your system</span>
<span id="cb53-669"><a href="#cb53-669" aria-hidden="true" tabindex="-1"></a>(if the package has such code).</span>
<span id="cb53-670"><a href="#cb53-670" aria-hidden="true" tabindex="-1"></a>That should mean the compiled code will work on your system, but requires you to have a</span>
<span id="cb53-671"><a href="#cb53-671" aria-hidden="true" tabindex="-1"></a>compiler available and things properly configured. A binary package doesn't need to be</span>
<span id="cb53-672"><a href="#cb53-672" aria-hidden="true" tabindex="-1"></a>compiled on your system, but in some cases (e.g., if you got the wrong binary version) the code may not run on your system because</span>
<span id="cb53-673"><a href="#cb53-673" aria-hidden="true" tabindex="-1"></a>it was compiled in such a way that is not compatible with your system.</span>
<span id="cb53-674"><a href="#cb53-674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-675"><a href="#cb53-675" aria-hidden="true" tabindex="-1"></a>Python *wheels* are a binary package format for Python packages. Wheels for some packages will vary by platform</span>
<span id="cb53-676"><a href="#cb53-676" aria-hidden="true" tabindex="-1"></a>(i.e., operating system) so that the package will install correctly on the system where it is being installed.</span>
<span id="cb53-677"><a href="#cb53-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-678"><a href="#cb53-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-679"><a href="#cb53-679" aria-hidden="true" tabindex="-1"></a><span class="fu"># 10. GitHub Actions and Continuous Integration</span></span>
<span id="cb53-680"><a href="#cb53-680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-681"><a href="#cb53-681" aria-hidden="true" tabindex="-1"></a>Having reproducible environments (e.g., Conda environments or Docker containers) provides the ability to run (and automate) various actions to run on remote/cloud computational resources and know that they (should) work.</span>
<span id="cb53-682"><a href="#cb53-682" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-683"><a href="#cb53-683" aria-hidden="true" tabindex="-1"></a>::: {callout-tip}</span>
<span id="cb53-684"><a href="#cb53-684" aria-hidden="true" tabindex="-1"></a><span class="fu">## Docker containers</span></span>
<span id="cb53-685"><a href="#cb53-685" aria-hidden="true" tabindex="-1"></a>Docker containers share some similarities with Conda environments except that you provide a full specification for the Linux operating system you want to use and software you want installed.</span>
<span id="cb53-686"><a href="#cb53-686" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb53-687"><a href="#cb53-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-688"><a href="#cb53-688" aria-hidden="true" tabindex="-1"></a>You need to provide the recipe for the environment or container. The automation system can then set up the environment as a virtual environment/container on the remote machine and run the action/code you request. This could simply be giving you a terminal or starting a Jupyter notebook in the environment and giving you access via your browser.</span>
<span id="cb53-689"><a href="#cb53-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-690"><a href="#cb53-690" aria-hidden="true" tabindex="-1"></a>In this section, we'll show some examples of automation with reproducible environments.</span>
<span id="cb53-691"><a href="#cb53-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-692"><a href="#cb53-692" aria-hidden="true" tabindex="-1"></a>There are a lot more out there. In fact, DataHub is based on Docker containers (and a container management service called Kubernetes). Let's see what operating system is being run in the container that your DataHub server is using.</span>
<span id="cb53-693"><a href="#cb53-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-694"><a href="#cb53-694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-695"><a href="#cb53-695" aria-hidden="true" tabindex="-1"></a><span class="in">$ cat /etc/issue</span></span>
<span id="cb53-696"><a href="#cb53-696" aria-hidden="true" tabindex="-1"></a><span class="in">Ubuntu 22.04.4 LTS \n \l</span></span>
<span id="cb53-697"><a href="#cb53-697" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-698"><a href="#cb53-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-699"><a href="#cb53-699" aria-hidden="true" tabindex="-1"></a>This is all quite powerful, and the use of reproducible environments generally helps with debugging because you can also set up the environment on your own machine. That said, running code remotely or in the cloud can also be hard to debug at times.</span>
<span id="cb53-700"><a href="#cb53-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-701"><a href="#cb53-701" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 1: Binder</span></span>
<span id="cb53-702"><a href="#cb53-702" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-703"><a href="#cb53-703" aria-hidden="true" tabindex="-1"></a>One example is using Binder to open a Jupyter notebook in an executable environment.</span>
<span id="cb53-704"><a href="#cb53-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-705"><a href="#cb53-705" aria-hidden="true" tabindex="-1"></a>Based on a configuration (various options are possible for how to specify the configuration), Binder will create a Docker container with the needed software installed.</span>
<span id="cb53-706"><a href="#cb53-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-707"><a href="#cb53-707" aria-hidden="true" tabindex="-1"></a>The most common configuration format is to provide a Conda environment file. Binder will then create a Conda environment inside the Docker (Linux) container. The Conda environment will contain the packages specified in the environment file. </span>
<span id="cb53-708"><a href="#cb53-708" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-709"><a href="#cb53-709" aria-hidden="true" tabindex="-1"></a>Let's set up a Binder environment "Geospatial analytics in Python with Geopandas" that can access the <span class="co">[</span><span class="ot">notebooks and materials provided in the repository</span><span class="co">](https://github.com/jorisvandenbossche/geopandas-tutorial)</span> in a <span class="co">[</span><span class="ot">computational environment</span><span class="co">](https://github.com/jorisvandenbossche/geopandas-tutorial/blob/main/environment.yml)</span> designed to use the notebooks reliably and reproducibly. </span>
<span id="cb53-710"><a href="#cb53-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-711"><a href="#cb53-711" aria-hidden="true" tabindex="-1"></a>In some cases an *image* for the container will already be available, and all that needs to happen is to start a virtual machine using that image as the computational environment. In other cases (e.g., with a configuration you've just created), the Docker container and Conda environment need to be set up.</span>
<span id="cb53-712"><a href="#cb53-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-713"><a href="#cb53-713" aria-hidden="true" tabindex="-1"></a>If we're familiar with what happens when Docker containers and Conda environments are set up, we can see in the Binder logs that a Docker container is set up (using Ubuntu Linux) and one of the steps of doing that is to create a Conda environment within the container.</span>
<span id="cb53-714"><a href="#cb53-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-715"><a href="#cb53-715" aria-hidden="true" tabindex="-1"></a>Let's see the steps that are run if we use the <span class="in">`mytoy`</span> repository to start a Binder environment at <span class="in">`ovh.mybinder.org`</span>, specifying <span class="in">`fperez/mytoy`</span> as the repository. (Note that in a number of cases, the startup has failed, probably because <span class="in">`mybinder`</span> has very limited resources for providing cloud compute resources. We are using <span class="in">`ovh.mybinder.org`</span> rather than <span class="in">`mybinder.org`</span> in hopes that is more likely to succeed.</span>
<span id="cb53-716"><a href="#cb53-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-717"><a href="#cb53-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-718"><a href="#cb53-718" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 2: GitHub Actions for automated testing</span></span>
<span id="cb53-719"><a href="#cb53-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-720"><a href="#cb53-720" aria-hidden="true" tabindex="-1"></a>A second example is using GitHub Actions (GHA) to automate activities such as testing. To set up a GitHub Actions workflow, one</span>
<span id="cb53-721"><a href="#cb53-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-722"><a href="#cb53-722" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>specifies when the workflow will run (e.g., when a push or pull request is made, or only manually)</span>
<span id="cb53-723"><a href="#cb53-723" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>provides instructions for how to set up the environment for the workflow</span>
<span id="cb53-724"><a href="#cb53-724" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>provides the operations that the workflow should run.</span>
<span id="cb53-725"><a href="#cb53-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-726"><a href="#cb53-726" aria-hidden="true" tabindex="-1"></a>A good example is running tests whenever you make a commit to a repository containing software.</span>
<span id="cb53-727"><a href="#cb53-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-728"><a href="#cb53-728" aria-hidden="true" tabindex="-1"></a>With GHA, you specify the operating system and then run the steps you specify in <span class="in">`.github/workflows/some_action.yml`</span>. Some steps will  customize the environment as the initial steps and then additional step(s) will run shell or other code to run your workflow. You use pre-specified operations (called *actions*) to do common things (such as checking out a GitHub repository and installing commonly used software). </span>
<span id="cb53-729"><a href="#cb53-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-730"><a href="#cb53-730" aria-hidden="true" tabindex="-1"></a>When triggered, GitHub will run the steps in a virtual machine, which is called the *runner*.</span>
<span id="cb53-731"><a href="#cb53-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-732"><a href="#cb53-732" aria-hidden="true" tabindex="-1"></a><span class="fu">### Joint demo/exercise</span></span>
<span id="cb53-733"><a href="#cb53-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-734"><a href="#cb53-734" aria-hidden="true" tabindex="-1"></a>We'll walk through the steps of setting up automated testing for the <span class="in">`mytoy`</span> example package. Why do this? It's common to have testing pass locally on your own machine, but fail for various reasons when done elsewhere. </span>
<span id="cb53-735"><a href="#cb53-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-736"><a href="#cb53-736" aria-hidden="true" tabindex="-1"></a>The workflow is specified using a YAML file placed in the <span class="in">`.github/workflows`</span> directory of the repository.</span>
<span id="cb53-737"><a href="#cb53-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-738"><a href="#cb53-738" aria-hidden="true" tabindex="-1"></a>Here's an example YAML file for testing the <span class="in">`mytoy`</span> package:</span>
<span id="cb53-739"><a href="#cb53-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-740"><a href="#cb53-740" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-741"><a href="#cb53-741" aria-hidden="true" tabindex="-1"></a><span class="in">on:</span></span>
<span id="cb53-742"><a href="#cb53-742" aria-hidden="true" tabindex="-1"></a><span class="in">  push:</span></span>
<span id="cb53-743"><a href="#cb53-743" aria-hidden="true" tabindex="-1"></a><span class="in">    branches:</span></span>
<span id="cb53-744"><a href="#cb53-744" aria-hidden="true" tabindex="-1"></a><span class="in">    - main</span></span>
<span id="cb53-745"><a href="#cb53-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-746"><a href="#cb53-746" aria-hidden="true" tabindex="-1"></a><span class="in">jobs:</span></span>
<span id="cb53-747"><a href="#cb53-747" aria-hidden="true" tabindex="-1"></a><span class="in">  CI:</span></span>
<span id="cb53-748"><a href="#cb53-748" aria-hidden="true" tabindex="-1"></a><span class="in">    runs-on: ubuntu-latest</span></span>
<span id="cb53-749"><a href="#cb53-749" aria-hidden="true" tabindex="-1"></a><span class="in">    steps:</span></span>
<span id="cb53-750"><a href="#cb53-750" aria-hidden="true" tabindex="-1"></a><span class="in">    - uses: actions/checkout@v4</span></span>
<span id="cb53-751"><a href="#cb53-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-752"><a href="#cb53-752" aria-hidden="true" tabindex="-1"></a><span class="in">    # Install dependencies</span></span>
<span id="cb53-753"><a href="#cb53-753" aria-hidden="true" tabindex="-1"></a><span class="in">    - name: Set up Python </span></span>
<span id="cb53-754"><a href="#cb53-754" aria-hidden="true" tabindex="-1"></a><span class="in">      uses: actions/setup-python@v5</span></span>
<span id="cb53-755"><a href="#cb53-755" aria-hidden="true" tabindex="-1"></a><span class="in">      with:</span></span>
<span id="cb53-756"><a href="#cb53-756" aria-hidden="true" tabindex="-1"></a><span class="in">        python-version: 3.12</span></span>
<span id="cb53-757"><a href="#cb53-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-758"><a href="#cb53-758" aria-hidden="true" tabindex="-1"></a><span class="in">    - name: Install mytoy</span></span>
<span id="cb53-759"><a href="#cb53-759" aria-hidden="true" tabindex="-1"></a><span class="in">      run: |</span></span>
<span id="cb53-760"><a href="#cb53-760" aria-hidden="true" tabindex="-1"></a><span class="in">        # There is a small bug here.</span></span>
<span id="cb53-761"><a href="#cb53-761" aria-hidden="true" tabindex="-1"></a><span class="in">        cd mytoy</span></span>
<span id="cb53-762"><a href="#cb53-762" aria-hidden="true" tabindex="-1"></a><span class="in">        pip install --user .</span></span>
<span id="cb53-763"><a href="#cb53-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-764"><a href="#cb53-764" aria-hidden="true" tabindex="-1"></a><span class="in">    - name: Run tests</span></span>
<span id="cb53-765"><a href="#cb53-765" aria-hidden="true" tabindex="-1"></a><span class="in">      run: |</span></span>
<span id="cb53-766"><a href="#cb53-766" aria-hidden="true" tabindex="-1"></a><span class="in">        # Another small bug here.</span></span>
<span id="cb53-767"><a href="#cb53-767" aria-hidden="true" tabindex="-1"></a><span class="in">        cd mytoy</span></span>
<span id="cb53-768"><a href="#cb53-768" aria-hidden="true" tabindex="-1"></a><span class="in">        pytest</span></span>
<span id="cb53-769"><a href="#cb53-769" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb53-770"><a href="#cb53-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-771"><a href="#cb53-771" aria-hidden="true" tabindex="-1"></a>We'll first run this with the current tests for <span class="in">`mytoy`</span>, which should pass when run via GitHub Actions.</span>
<span id="cb53-772"><a href="#cb53-772" aria-hidden="true" tabindex="-1"></a>We can take a look at <span class="co">[</span><span class="ot">the output</span><span class="co">](https://github.com/fperez/mytoy/actions)</span>.</span>
<span id="cb53-773"><a href="#cb53-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-774"><a href="#cb53-774" aria-hidden="true" tabindex="-1"></a>Next, let's introduce a failing test to see what the output looks like and get a sense for how to debug it.</span>
<span id="cb53-775"><a href="#cb53-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-776"><a href="#cb53-776" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-777"><a href="#cb53-777" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-778"><a href="#cb53-778" aria-hidden="true" tabindex="-1"></a><span class="fu">## Example 3: GitHub Actions for publishing webpages</span></span>
<span id="cb53-779"><a href="#cb53-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-780"><a href="#cb53-780" aria-hidden="true" tabindex="-1"></a>We can use GitHub Actions with GitHub pages to easily publish websites, where we make changes to the repository and the workflow causes the website to be updated.</span>
<span id="cb53-781"><a href="#cb53-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-782"><a href="#cb53-782" aria-hidden="true" tabindex="-1"></a>Here's the <span class="co">[</span><span class="ot">GitHub Actions workflow (a YAML file)</span><span class="co">](https://github.com/UCB-stat-159-s23/site/blob/main/.github/workflows/book.yml)</span> that publishes the website for the spring 2023 version of Statistics 159/259. Any commits made in the <span class="in">`main`</span> branch cause the website to be updated.</span>
<span id="cb53-783"><a href="#cb53-783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-784"><a href="#cb53-784" aria-hidden="true" tabindex="-1"></a><span class="fu">### Configuring GitHub Pages</span></span>
<span id="cb53-785"><a href="#cb53-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-786"><a href="#cb53-786" aria-hidden="true" tabindex="-1"></a>To set up GitHub Pages for a repository, go to <span class="in">`https://github.com/github_org/repository/settings/pages`</span> and select <span class="in">`Source -&gt; Deploy from a branch`</span> and then choose <span class="in">`gh-pages`</span> as the branch (first creating the <span class="in">`gh-pages`</span> branch if necessary). The website should appear at <span class="in">`github_org.github.io/repository`</span>.</span>
<span id="cb53-787"><a href="#cb53-787" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-788"><a href="#cb53-788" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quarto-based websites</span></span>
<span id="cb53-789"><a href="#cb53-789" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-790"><a href="#cb53-790" aria-hidden="true" tabindex="-1"></a>In fact the website for this workshop was done using Quarto, which uses GitHub Pages and GitHub Actions behind the scenes.</span>
<span id="cb53-791"><a href="#cb53-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-792"><a href="#cb53-792" aria-hidden="true" tabindex="-1"></a>Chris runs <span class="in">`quarto publish gh-pages`</span> to update the site. Quarto will (on the local machine) render the html (convert the Markdown to html) and then behind the scenes Quarto uses <span class="co">[</span><span class="ot">GitHub Actions</span><span class="co">](https://github.com/berkeley-scf/compute-skills-2025/actions)</span> and <span class="co">[</span><span class="ot">GitHub Pages (via the `gh-pages branch)</span><span class="co">](https://github.com/berkeley-scf/compute-skills-2025/tree/gh-pages)</span> to publish the website.</span>
<span id="cb53-793"><a href="#cb53-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-794"><a href="#cb53-794" aria-hidden="true" tabindex="-1"></a><span class="fu"># Feedback survey</span></span>
<span id="cb53-795"><a href="#cb53-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-796"><a href="#cb53-796" aria-hidden="true" tabindex="-1"></a>This is only the second time we've done this, so it's helpful now to get feedback on it. Please fill out this <span class="co">[</span><span class="ot">brief survey</span><span class="co">](https://docs.google.com/forms/d/e/1FAIpQLScXrPcjThkfguJ56zbtU_VB8aZ1K5fWBeLaY4GDZNnEve1JJQ/viewform?usp=dialog)</span>.</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>